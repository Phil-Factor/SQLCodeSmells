<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5.dev">
<meta name="author" content="by Phil Factor">
<title>SQL Code Smells</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>SQL Code Smells</h1>
<div class="details">
<span id="author" class="author">by Phil Factor</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#problems-with-database-design">1. Problems with Database Design</a>
<ul class="sectlevel2">
<li><a href="#packing-lists-complex-data-or-other-multivariate-attributes-into-a-table-column">1.1. Packing lists, complex data, or other multivariate attributes into a table column</a></li>
<li><a href="#using-inappropriate-data-types">1.2. Using inappropriate data types</a></li>
<li><a href="#storing-the-hierarchy-structure-in-the-same-table-as-the-entities-that-make-up-the-hierarchy">1.3. Storing the hierarchy structure in the same table as the entities that make up the hierarchy</a></li>
<li><a href="#using-an-entity-attribute-value-eav-model">1.4. Using an Entity Attribute Value (EAV) model</a></li>
<li><a href="#using-a-polymorphic-association">1.5. Using a polymorphic association</a></li>
<li><a href="#creating-tables-as-god-objects">1.6. Creating tables as 'God Objects'</a></li>
<li><a href="#contrived-interfaces">1.7. Contrived interfaces</a></li>
<li><a href="#using-command-line-and-ole-automation-to-access-server-based-resources">1.8. Using command-line and OLE automation to access server-based resources</a></li>
</ul>
</li>
<li><a href="#problems-with-table-design">2. Problems with Table Design</a>
<ul class="sectlevel2">
<li><a href="#using-constraints-to-restrict-values-in-a-column">2.1. Using constraints to restrict values in a column</a></li>
<li><a href="#not-using-referential-integrity-constraints">2.2. Not using referential integrity constraints</a></li>
<li><a href="#enabling-nocheck-on-referential-integrity-constraints">2.3. Enabling NOCHECK on referential integrity constraints</a></li>
<li><a href="#using-too-many-or-too-few-indexes">2.4. Using too many or too few indexes</a></li>
<li><a href="#not-choosing-the-most-suitable-clustered-index-for-a-table">2.5. Not choosing the most suitable clustered index for a table</a></li>
<li><a href="#not-explicitly-declaring-which-index-is-the-clustered-one.">2.6. Not explicitly declaring which index is the clustered one.</a></li>
<li><a href="#misusing-null-values">2.7. Misusing NULL values</a></li>
<li><a href="#using-temporary-tables-for-very-small-result-sets">2.8. Using temporary tables for very small result sets</a></li>
<li><a href="#creating-a-table-without-specifying-a-schema">2.9. Creating a table without specifying a schema</a></li>
<li><a href="#most-tables-should-have-a-clustered-index">2.10. Most tables should have a clustered index</a></li>
<li><a href="#using-the-same-column-name-in-different-tables-but-with-different-data-types">2.11. Using the same column name in different tables but with different data types</a></li>
<li><a href="#defining-a-table-column-without-explicitly-specifying-whether-it-is-nullable">2.12. Defining a table column without explicitly specifying whether it is nullable</a></li>
<li><a href="#adding-not-null-column-without-default-value-to-a-table-with-data-will-fail">2.13. Trying to add a NOT NULL column without default value to a table with data</a></li>
<li><a href="#creating-dated-copies-of-the-same-table-to-manage-table-sizes">2.14. Creating dated copies of the same table to manage table sizes</a></li>
</ul>
</li>
<li><a href="#problems-with-data-types">3. Problems with Data Types</a>
<ul class="sectlevel2">
<li><a href="#using-varchar1-varchar2-etc.">3.1. Using VARCHAR(1), VARCHAR(2), etc.</a></li>
<li><a href="#declaring-var-type-variables-without-length">3.2. Declaring var type variables without length</a></li>
<li><a href="#using-deprecated-language-elements-such-as-the-textntext-data-types">3.3. Using deprecated language elements such as the TEXT/NTEXT data types</a></li>
<li><a href="#using-money-data-type">3.4. Using MONEY data type</a></li>
<li><a href="#using-float-or-real-data-types">3.5. <em>Using FLOAT or REAL data types</em></a></li>
<li><a href="#mixing-parameter-data-types-in-a-coalesce-expression">3.6. Mixing parameter data types in a COALESCE expression</a></li>
<li><a href="#using-datetime-or-datetime2-when-youre-concerned-only-with-the-date">3.7. Using DATETIME or DATETIME2 when you&#8217;re concerned only with the date</a></li>
<li><a href="#using-datetime-or-datetime2-when-youre-merely-recording-the-time-of-day">3.8. Using DATETIME or DATETIME2 when you&#8217;re merely recording the time of day</a></li>
<li><a href="#using-sql_variant-inappropriately">3.9. Using sql_variant inappropriately</a></li>
<li><a href="#the-length-of-the-varchar-varbinary-and-nvarchar-datatype-in-a-cast-or-convert-clause-wasnt-explicitly-specified">3.10. The length of the VARCHAR, VARBINARY and NVARCHAR datatype in a CAST or CONVERT clause wasn&#8217;t explicitly specified</a></li>
<li><a href="#storing-a-duration-rather-than-a-point-in-time">3.11. Storing a duration rather than a point in time</a></li>
<li><a href="#using-varcharmax-or-nvarcharmax-when-it-isnt-necessary">3.12. Using VARCHAR(MAX) or NVARCHAR(MAX) when it isn&#8217;t necessary</a></li>
<li><a href="#using-varchar-rather-than-nvarchar-for-anything-that-requires-internationalisation-such-as-names-or-addresses">3.13. Using VARCHAR rather than NVARCHAR for anything that requires internationalisation, such as names or addresses</a></li>
<li><a href="#declaring-varchar-varbinary-and-nvarchar-datatypes-without-explicit-length">3.14. Declaring VARCHAR, VARBINARY and NVARCHAR datatypes without explicit length</a></li>
</ul>
</li>
<li><a href="#problems-with-expressions">4. Problems with expressions</a>
<ul class="sectlevel2">
<li><a href="#excessive-use-of-parentheses">4.1. Excessive use of parentheses</a></li>
<li><a href="#using-functions-such-as-isnumeric-without-additional-checks">4.2. Using functions such as 'ISNUMERIC' without additional checks</a></li>
<li><a href="#injudicious-use-of-the-ltrim-and-rtrim-functions">4.3. Injudicious use of the LTRIM and RTRIM functions</a></li>
<li><a href="#using-datalength-rather-than-len-to-find-the-length-of-a-string.">4.4. Using DATALENGTH rather than LEN to find the length of a string.</a></li>
<li><a href="#not-using-a-semicolon-to-terminate-sql-statements">4.5. Not using a semicolon to terminate SQL statements</a></li>
<li><a href="#relying-on-data-being-implicitly-converted-between-types">4.6. Relying on data being implicitly converted between types</a></li>
<li><a href="#using-the-identity-system-function">4.7. Using the @@IDENTITY system function</a></li>
<li><a href="#using-between-for-datetime-ranges">4.8. Using BETWEEN for DATETIME ranges</a></li>
<li><a href="#using-select-in-a-batch">4.9. Using SELECT * in a batch</a></li>
<li><a href="#insert-without-column-list">4.10. INSERT without column list</a></li>
<li><a href="#order-by-clause-with-constants">4.11. ORDER BY clause with constants</a></li>
</ul>
</li>
<li><a href="#difficulties-with-query-syntax">5. Difficulties with Query Syntax</a>
<ul class="sectlevel2">
<li><a href="#creating-uberqueries-god-like-queries">5.1. Creating UberQueries (God-like Queries)</a></li>
<li><a href="#nesting-views-as-if-they-were-russian-dolls">5.2. Nesting views as if they were Russian dolls</a></li>
<li><a href="#joins-between-large-views">5.3. Joins between large views</a></li>
<li><a href="#using-the-old-sybase-join-syntax">5.4. Using the old Sybase JOIN syntax</a></li>
<li><a href="#using-correlated-subqueries-instead-of-a-join">5.5. Using correlated subqueries instead of a join</a></li>
<li><a href="#using-select-rather-than-set-to-assign-values-to-variables">5.6. Using SELECT rather than SET to assign values to variables</a></li>
<li><a href="#using-scalar-user-defined-functions-udfs-for-data-lookups-as-a-poor-mans-join.">5.7. Using scalar user-defined functions (UDFs) for data lookups as a poor man&#8217;s join.</a></li>
<li><a href="#not-using-two-part-object-names-for-object-references">5.8. Not using two-part object names for object references</a></li>
<li><a href="#using-insert-into-without-specifying-the-columns-and-their-order">5.9. Using INSERT INTO without specifying the columns and their order</a></li>
<li><a href="#using-full-outer-joins-unnecessarily.">5.10. Using full outer joins unnecessarily.</a></li>
<li><a href="#including-complex-conditionals-in-the-where-clause">5.11. Including complex conditionals in the WHERE clause</a></li>
<li><a href="#mixing-data-types-in-joins-or-where-clauses">5.12. Mixing data types in joins or WHERE clauses</a></li>
<li><a href="#assuming-that-select-statements-all-have-roughly-the-same-execution-time">5.13. Assuming that SELECT statements all have roughly the same execution time</a></li>
<li><a href="#not-handling-null-values-in-nullable-columns">5.14. Not handling NULL values in nullable columns</a></li>
<li><a href="#referencing-an-unindexed-column-within-the-in-predicate-of-a-where-clause">5.15. Referencing an unindexed column within the IN predicate of a WHERE clause</a></li>
<li><a href="#using-like-in-a-where-clause-with-an-initial-wildcard-character">5.16. Using LIKE in a WHERE clause with an initial wildcard character</a></li>
<li><a href="#using-a-predicate-or-join-column-as-a-parameter-for-a-user-defined-function">5.17. Using a predicate or join column as a parameter for a user-defined function</a></li>
<li><a href="#supplying-object-names-without-specifying-the-schema">5.18. Supplying object names without specifying the schema</a></li>
<li><a href="#using-null-or-null-to-filter-a-nullable-column-for-nulls">5.19. Using '== NULL' or '&lt;&gt; NULL' to filter a nullable column for NULLs</a></li>
<li><a href="#not-using-nocount-on-in-stored-procedures-and-triggers">5.20. Not using NOCOUNT ON in stored procedures and triggers</a></li>
<li><a href="#using-the-not-in-predicate-in-the-where-clause">5.21. Using the NOT IN predicate in the WHERE clause</a></li>
<li><a href="#defining-foreign-keys-without-a-supporting-index">5.22. Defining foreign keys without a supporting index</a></li>
<li><a href="#using-a-non-sargable-search-argument..able-expression-in-a-where-clause">5.23. Using a non-SARGable (Search ARGument..able) expression in a WHERE clause</a></li>
<li><a href="#including-a-deterministic-function-in-a-where-clause">5.24. Including a deterministic function in a WHERE clause</a></li>
<li><a href="#trueusing-an-unverified-scalar-user-defined-function-as-a-constant">5.25. Using an unverified  scalar user-defined function as a constant.</a></li>
<li><a href="#using-select-distinct-to-mask-a-join-problem">5.26. Using SELECT DISTINCT to mask a join problem</a></li>
<li><a href="#using-not-in-with-an-expression-that-allows-null-values">5.27. Using NOT IN with an expression that allows null values</a></li>
<li><a href="#a-delete-statement-has-omitted-that-where-clause-which-would-delete-the-whole-table">5.28. A DELETE statement has omitted that WHERE clause, which would delete the whole table</a></li>
<li><a href="#an-update-statement-has-omitted-the-where-clause-which-would-update-every-row-in-the-table">5.29. An UPDATE statement has omitted the WHERE clause, which would update every row in the table</a></li>
<li><a href="#trueusing-a-common-table-expression-cte-unnecessarily">5.30. Using a Common Table Expression (CTE) unnecessarily</a></li>
</ul>
</li>
<li><a href="#problems-with-naming">6. Problems with naming</a>
<ul class="sectlevel2">
<li><a href="#excessively-long-or-short-identifiers">6.1. Excessively long or short identifiers</a></li>
<li><a href="#using-sp_-prefixes-for-stored-procedures">6.2. Using sp_ prefixes for stored procedures</a></li>
<li><a href="#tibbling-sql-server-objects-with-reverse-hungarian-prefixes-such-as-tbl_-vw_-pk_-fn_-and-usp_">6.3. 'Tibbling' SQL Server objects with Reverse-Hungarian prefixes such as tbl_, vw_, pk_, fn_, and usp_</a></li>
<li><a href="#using-reserved-words-in-names">6.4. Using reserved words in names</a></li>
<li><a href="#including-special-characters-in-object-names">6.5. Including special characters in object names</a></li>
<li><a href="#using-numbers-in-table-names">6.6. Using numbers in table names</a></li>
<li><a href="#see-sr0011-avoid-using-special-characters-in-object-names">6.7. See: <a href="http://msdn.microsoft.com/en-us/library/dd172134(v=vs.100).aspx" class="bare">http://msdn.microsoft.com/en-us/library/dd172134(v=vs.100).aspx</a>[SR0011: Avoid using special characters in object names*</a></li>
<li><a href="#using-square-brackets-unnecessarily-for-object-names">6.8. Using square brackets unnecessarily for object names</a></li>
<li><a href="#using-system-generated-object-names-particularly-for-constraints">6.9. Using system-generated object names, particularly for constraints</a></li>
</ul>
</li>
<li><a href="#problems-with-routines">7. Problems with routines</a>
<ul class="sectlevel2">
<li><a href="#including-few-or-no-comments">7.1. Including few or no comments</a></li>
<li><a href="#you-have-a-stored-procedure-that-does-not-return-a-result-code">7.2. You have a stored procedure that does not return a result code</a></li>
<li><a href="#excessively-overloading-routines">7.3. Excessively 'overloading' routines</a></li>
<li><a href="#creating-routines-especially-stored-procedures-as-god-routines-or-uberprocs">7.4. Creating routines (especially stored procedures) as 'God Routines' or 'UberProcs'</a></li>
<li><a href="#creating-stored-procedures-that-return-more-than-one-result-set">7.5. Creating stored procedures that return more than one result set</a></li>
<li><a href="#creating-a-multi-statement-table-valued-function-or-a-scalar-function-when-an-inline-function-is-possible">7.6. Creating a Multi-statement table-valued function, or a scalar function when an inline function is possible</a></li>
<li><a href="#too-many-parameters-in-stored-procedures-or-functions">7.7. Too many parameters in stored procedures or functions</a></li>
<li><a href="#duplicated-code">7.8. Duplicated code</a></li>
<li><a href="#high-cyclomatic-complexity">7.9. High cyclomatic complexity</a></li>
<li><a href="#using-an-order-by-clause-within-a-view">7.10. Using an ORDER BY clause within a view</a></li>
<li><a href="#unnecessarily-using-stored-procedures-or-multiline-table-valued-functions-where-a-view-is-sufficient">7.11. Unnecessarily using stored procedures or multiline table-valued functions where a view is sufficient</a></li>
<li><a href="#using-cursors">7.12. Using Cursors</a></li>
<li><a href="#you-have-not-explicitly-defined-the-scope-of-a-cursor">7.13. You have not explicitly defined the scope of a cursor</a></li>
<li><a href="#overusing-clr-routines">7.14. Overusing CLR routines</a></li>
<li><a href="#excessive-use-of-the-while-loop">7.15. Excessive use of the WHILE loop</a></li>
<li><a href="#relying-on-the-insertexec-statement">7.16. Relying on the INSERT &#8230;&#8203; EXEC statement</a></li>
<li><a href="#stored-procedure-that-does-not-set-a-return-code">7.17. Executing stored procedure without getting result</a></li>
<li><a href="#forgetting-to-set-an-output-variable">7.18. Forgetting to set an output variable</a></li>
<li><a href="#specifying-parameters-by-order-rather-by-assignment-where-there-are-more-than-four-parameters">7.19. Specifying parameters by order rather by assignment, where there are more than four parameters</a></li>
<li><a href="#try-to-avoid-using-hardcoded-references-to-other-databases.">7.20. Try to avoid using hardcoded references to other databases.</a></li>
<li><a href="#use-of-a-hardcoded-current-database-name-in-a-procedure-call">7.21. Use of a Hardcoded current database name in a procedure call</a></li>
<li><a href="#setting-the-quoted_identifier-or-ansi_nulls-options-inside-stored-procedures">7.22. Setting the QUOTED_IDENTIFIER or ANSI_NULLS options inside stored procedures</a></li>
<li><a href="#creating-a-routine-with-ansi_nulls-or-quoted_identifier-options-set-to-off.">7.23. Creating a routine with ANSI_NULLS or QUOTED_IDENTIFIER options set to OFF.</a></li>
<li><a href="#updating-a-primary-key-column">7.24. Updating a primary key column</a></li>
<li><a href="#overusing-hints-to-force-a-particular-behaviour-in-joins">7.25. Overusing hints to force a particular behaviour in joins</a></li>
<li><a href="#using-the-charindex-function-in-a-where-clause">7.26. Using the CHARINDEX function in a WHERE Clause</a></li>
<li><a href="#using-the-nolock-hint">7.27. Using the NOLOCK hint</a></li>
<li><a href="#using-a-waitfor-delaytime-statement-in-a-routine-or-batch">7.28. Using a WAITFOR DELAY/TIME statement in a routine or batch</a></li>
<li><a href="#using-set-rowcount-to-specify-how-many-rows-should-be-returned">7.29. Using SET ROWCOUNT to specify how many rows should be returned</a></li>
<li><a href="#using-top-100-percent-in-views-inline-functions-derived-tables-subqueries-and-common-table-expressions-ctes.">7.30. Using TOP 100 PERCENT in views, inline functions, derived tables, subqueries, and common table expressions (CTEs).</a></li>
<li><a href="#not-specifying-the-schema-name-for-a-procedure">7.31. Not specifying the Schema name for a procedure</a></li>
<li><a href="#duplicating-names-of-objects-of-different-types">7.32. Duplicating names of objects of different types</a></li>
<li><a href="#using-while-not-done-loops-without-an-error-exit">7.33. Using WHILE (not done) loops without an error exit</a></li>
<li><a href="#using-a-print-statement-or-statement-that-returns-a-result-in-a-trigger">7.34. Using a PRINT statement or statement that returns a result in a trigger</a></li>
<li><a href="#select-statement-in-trigger-that-returns-data-to-the-client">7.35. SELECT statement in trigger that returns data to the client</a></li>
<li><a href="#using-top-without-order-by">7.36. Using TOP without ORDER BY</a></li>
<li><a href="#using-a-case-statement-without-the-else-clause">7.37. Using a CASE statement without the ELSE clause</a></li>
<li><a href="#using-executestring">7.38. Using EXECUTE(string)</a></li>
<li><a href="#using-the-group-by-all-column-group-by-number-compute-or-compute-by-clause">7.39. Using the GROUP BY ALL &lt;column&gt;, GROUP BY &lt;number&gt;, COMPUTE, or COMPUTE BY clause</a></li>
<li><a href="#using-numbers-in-the-order-by-clause-to-specify-column-order">7.40. Using numbers in the ORDER BY clause to specify column order</a></li>
<li><a href="#using-unnecessary-three-part-and-four-part-column-references-in-a-select-list">7.41. Using unnecessary three-part and four-part column references in a select list</a></li>
<li><a href="#using-range-rather-than-rows-in-sql-server-2012">7.42. Using RANGE rather than ROWS in SQL Server 2012</a></li>
<li><a href="#doing-complex-error-handling-in-a-transaction-before-the-rollback-command">7.43. Doing complex error-handling in a transaction before the ROLLBACK command</a></li>
<li><a href="#use-of-begin-transaction-without-rollback-transaction">7.44. Use of BEGIN TRANSACTION without ROLLBACK TRANSACTION</a></li>
<li><a href="#use-of-rollback-transaction-without-begin-transaction">7.45. Use of ROLLBACK TRANSACTION without BEGIN TRANSACTION</a></li>
<li><a href="#not-defining-a-default-value-for-a-select-assignment-to-a-variable">7.46. Not defining a default value for a SELECT assignment to a variable</a></li>
<li><a href="#not-defining-a-default-value-for-a-set-assignment-that-is-the-result-of-a-query">7.47. Not defining a default value for a SET assignment that is the result of a query</a></li>
<li><a href="#the-value-of-a-nullable-column-is-not-checked-for-nulls-when-used-in-an-expression">7.48. The value of a nullable column is not checked for NULLs when used in an expression</a></li>
<li><a href="#using-the-nullif-expression">7.49. Using the NULLIF expression</a></li>
<li><a href="#not-putting-all-the-ddl-statements-at-the-beginning-of-the-batch">7.50. Not putting all the DDL statements at the beginning of the batch</a></li>
<li><a href="#using-meaningless-aliases-for-tables-e.g.-a-b-c-d-e">7.51. Using meaningless aliases for tables (e.g., a, b, c, d, e)</a></li>
<li><a href="#variable-type-is-not-fully-compatible-with-procedure-parameter-type">7.52. Variable type is not fully compatible with procedure parameter type</a></li>
<li><a href="#literal-type-is-not-fully-compatible-with-procedure-parameter-type">7.53. Literal type is not fully compatible with procedure parameter type</a></li>
<li><a href="#subquery-may-return-more-than-one-row">7.54. Subquery may return more than one row</a></li>
<li><a href="#a-named-parameter-is-not-found-in-parameter-list-of-a-procedure">7.55. A named parameter is not found in parameter list of a procedure</a></li>
<li><a href="#use-of-the-position-notation-after-the-named-notation-for-parameters-when-calling-a-procedure">7.56. Use of the position notation after the named notation for parameters when calling a procedure</a></li>
<li><a href="#parameter-is-not-passed-to-a-procedure-and-no-default-is-provided.">7.57. Parameter is not passed to a procedure and no default is provided.</a></li>
<li><a href="#procedure-parameter-is-not-defined-as-output-but-marked-as-output-in-procedure-call-statement.">7.58. Procedure parameter is not defined as OUTPUT, but marked as OUTPUT in procedure call statement.</a></li>
<li><a href="#procedure-parameter-is-defined-as-output-but-is-not-marked-as-output-in-procedure-call-statement.">7.59. Procedure parameter is defined as OUTPUT, but is not marked as OUTPUT in procedure call statement.</a></li>
<li><a href="#number-of-passed-parameters-exceeds-the-number-of-procedure-parameters">7.60. Number of passed parameters exceeds the number of procedure parameters</a></li>
</ul>
</li>
<li><a href="#security-loopholes">8. Security Loopholes</a>
<ul class="sectlevel2">
<li><a href="#using-sql-server-logins-especially-without-password-expirations-or-windows-password-policy">8.1. Using SQL Server logins, especially without password expirations or Windows password policy</a></li>
<li><a href="#using-the-xp_cmdshell-system-stored-procedure">8.2. Using the xp_cmdshell system stored procedure</a></li>
<li><a href="#authentication-set-to-mixed-mode">8.3. Authentication set to Mixed Mode</a></li>
<li><a href="#using-dynamic-sql-without-the-with-execute-as-clause">8.4. Using dynamic SQL without the WITH EXECUTE AS clause</a></li>
<li><a href="#using-dynamic-sql-with-the-possibility-of-sql-injection">8.5. Using dynamic SQL with the possibility of SQL injection</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you&#8217;ve done a number of SQL code-reviews, you&#8217;ll be able to spot signs in the code that indicate all might not be well. These <a href="http://www.c2.com/cgi/wiki?CodeSmell">'code smells'</a> are coding styles that, while not bugs, suggest design problems with the code.</p>
</div>
<div class="paragraph">
<p>Kent Beck and Massimo Arnoldi seem to have coined the term 'Code Smell' in the 'http://www.c2.com/cgi/wiki?OnceAndOnlyOnce[Once And Only Once]' page of www.C2.com, where Kent also said that code 'wants to be simple'. Kent Beck and Martin Fowler expand on the issue of code challenges in their essay 'Bad Smells in Code', published as Chapter 3 of the book <em>Refactoring: Improving the Design of Existing Code</em> (ISBN 978-0201485677).</p>
</div>
<div class="paragraph">
<p>Although there are generic code smells, SQL has its own particular habits that will alert the programmer to the need to refactor code. (For grounding in code smells in C#, see 'https://www.simple-talk.com/dotnet/.net-framework/exploring-smelly-code/[Exploring Smelly Code'] and 'https://www.simple-talk.com/dotnet/.net-framework/code-deodorants-for-code-smells/[Code Deodorants for Code Smells]' by Nick Harrison.) Plamen Ratchev&#8217;s wonderful article 'https://www.simple-talk.com/sql/t-sql-programming/ten-common-sql-programming-mistakes/[Ten Common SQL Programming Mistakes'] lists some of these code smells along with out-and-out mistakes, but there are more. The use of nested transactions, for example, isn&#8217;t entirely incorrect, even though the database engine ignores all but the outermost, but their use does flag the possibility the programmer thinks that nested transactions are supported.</p>
</div>
<div class="paragraph">
<p>If you are moving towards continuous delivery of database applications, you should automate as much as possible the preliminary SQL code-review. It&#8217;s a lot easier to trawl through your code automatically to pick out problems, than to do so manually. Imagine having something like the classic 'lint' tools used for C, or better still, a tool similar to <a href="https://www.simple-talk.com/opinion/geek-of-the-week/peli-de-halleux-geek-of-the-week/">Jonathan 'Peli' de Halleux</a>'s Code Metrics plug-in for .NET Reflector, which finds code smells in .NET code.</p>
</div>
<div class="paragraph">
<p>One can be a bit defensive about SQL code smells. I will cheerfully write very long stored procedures, even though they are frowned upon. I&#8217;ll even use dynamic SQL on occasion. You should use code smells only as an aid. It is fine to 'sign them off' as being inappropriate in certain circumstances. In fact, whole classes of code smells may be irrelevant for a particular database. The use of proprietary SQL, for example, is only a code smell if there is a chance that the database will be ported to another RDBMS. The use of dynamic SQL is a risk only with certain security models. Ultimately, you should rely on your own judgment. As the saying goes, a code smell is a hint of possible bad practice to a pragmatist, but a sure sign of bad practice to a purist.</p>
</div>
<div class="paragraph">
<p>In describing all these code-smells in a booklet, I&#8217;ve been very constrained on space to describe each code-small. Some code-smells would require a whole article to explain them properly. Fortunately, SQL Server Central and Simple-Talk have, between them, published material on almost all these code smells, so if you get interested, please explore these essential archives of information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="problems-with-database-design"><a class="anchor" href="#problems-with-database-design"></a>1. Problems with Database Design</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="packing-lists-complex-data-or-other-multivariate-attributes-into-a-table-column"><a class="anchor" href="#packing-lists-complex-data-or-other-multivariate-attributes-into-a-table-column"></a>1.1. Packing lists, complex data, or other multivariate attributes into a table column</h3>
<div class="paragraph">
<p>It is permissible to put a list or data document in a column only if it is, from the database perspective, 'atomic', that is, never likely to be shredded into individual values; in other words, it is fine as long as the value remains in the format in which it started. You should never need to split an 'atomic' value. We can deal with values that contain more than a single item of information: We store strings, after all, and a string is hardly atomic in the sense that it consists of an ordinally significant collection of characters or words. However, the string shouldn&#8217;t represent a list of values. If you need to parse the value of a column to access values within it,  it is likely to need to be normalised, and it will certainly be slow.
Occasionally, a data object is too complicated, peripheral, arcane or ephemeral to be worth integrating with the database&#8217;s normalised structure. It is fair to then take an arm&#8217;s-length approach and store it as XML, but in this case it will need to be encapsulated by views and table-valued functions so that the SQL Programmer can easily access the contents.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/smell1.bmp" alt="smell1.bmp">
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-inappropriate-data-types"><a class="anchor" href="#using-inappropriate-data-types"></a>1.2. Using inappropriate data types</h3>
<div class="paragraph">
<p>Although a business may choose to represent a date as a single string of numbers or require codes that mix text with numbers, it is unsatisfactory to store such data in columns that don&#8217;t match the actual data type. This confuses the presentation of data with its storage. Dates, money, codes and other business data can be represented in a human-readable form, the 'presentation' mode, they can be represented in their storage form, or in their data-interchange form. Storing data in the wrong form as strings leads to major issues with coding, indexing, sorting, and other operations. Put the data into the appropriate 'storage' data type at all times.</p>
</div>
</div>
<div class="sect2">
<h3 id="storing-the-hierarchy-structure-in-the-same-table-as-the-entities-that-make-up-the-hierarchy"><a class="anchor" href="#storing-the-hierarchy-structure-in-the-same-table-as-the-entities-that-make-up-the-hierarchy"></a>1.3. Storing the hierarchy structure in the same table as the entities that make up the hierarchy</h3>
<div class="paragraph">
<p>Self-referencing tables seem like an elegant way to represent hierarchies. However, such an approach mixes relationships and values. Real-life hierarchies need more than a parent-child relationship. The 'Closure Table' pattern, where the relationships are held in a table separate from the data, is much more suitable for real-life hierarchies. Also, in real life, relationships tend have a beginning and an end, and this often needs to be recorded. The HIERARCHYID data type and the common language runtime (CLR) <strong>SqlHierarchyId</strong> class are provided to make tree structures represented by self-referencing tables more efficient, but they are likely to be appropriate for only a minority of applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-an-entity-attribute-value-eav-model"><a class="anchor" href="#using-an-entity-attribute-value-eav-model"></a>1.4. Using an Entity Attribute Value (EAV) model</h3>
<div class="paragraph">
<p>The use of an EAV model is almost never justified and leads to very tortuous SQL code that is extraordinarily difficult to apply any sort of constraint to. When faced with providing a 'persistence layer' for an application that doesn&#8217;t understand the nature of the data, use XML instead. That way, you can use XSD to enforce data constraints, create indexes on the data, and use XPath to query specific elements within the XML. It is then, at least, a reliable database, even though it isn&#8217;t relational!</p>
</div>
</div>
<div class="sect2">
<h3 id="using-a-polymorphic-association"><a class="anchor" href="#using-a-polymorphic-association"></a>1.5. Using a polymorphic association</h3>
<div class="paragraph">
<p>Sometimes, one sees table designs which have 'keys' that can reference more than one table, whose identity is usually denoted by a separate column. This is where an entity can relate to one of a number of different entities according to the value in another column that provides the identity of the entity. This sort of relationship cannot be subject to foreign key constraints, and any joins are difficult for the query optimizer to provide good plans for. Also, the logic for the joins is likely to get complicated. Instead, use an intersection table, or if you are attempting an object-oriented mapping, look at the method by which SQL Server represents the database metadata by creating an 'object' supertype class that all of the individual object types extend. Both these devices give you the flexibility of design that polymorphic associations attempt.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Polymorphic.bmp" alt="Polymorphic.bmp">
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-tables-as-god-objects"><a class="anchor" href="#creating-tables-as-god-objects"></a>1.6. Creating tables as 'God Objects'</h3>
<div class="paragraph">
<p>'God Tables' are usually the result of an attempt to encapsulate a large part of the data for the business domain in a single wide table. This is usually a normalization error, or rather, a rash and over-ambitious attempt to 'denormalise' the database structure. If you have a table with many columns, it is likely that you have come to grief on the third normal form. It could also be the result of believing, wrongly, that all joins come at great and constant cost. Normally they can be replaced by views or table-valued functions. Indexed views can have maintenance overhead but are greatly superior to denormalisation.</p>
</div>
</div>
<div class="sect2">
<h3 id="contrived-interfaces"><a class="anchor" href="#contrived-interfaces"></a>1.7. Contrived interfaces</h3>
<div class="paragraph">
<p>Quite often, the database designer will need to create an interface to provide an abstraction layer, between schemas within a database, between database and ETL process, or between a database and application. You face a choice between uniformity, and simplicity. Overly complicated <a href="http://en.wikipedia.org/wiki/Design_pattern_(computer_science)">interfaces</a>, for whatever reason, should never be used where a simpler design would suffice. It is always best to choose simplicity over conformity. Interfaces have to be clearly documented and maintained, let alone understood.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-command-line-and-ole-automation-to-access-server-based-resources"><a class="anchor" href="#using-command-line-and-ole-automation-to-access-server-based-resources"></a>1.8. Using command-line and OLE automation to access server-based resources</h3>
<div class="paragraph">
<p>In designing a database application, there is sometimes functionality that cannot be done purely in SQL, usually when other server-based, or network-based, resources must be accessed. Now that SQL Server&#8217;s integration with PowerShell is so much more mature, it is better to use that, rather than xp_cmdshell or sp_OACreate (or similar), to access the file system or other server-based resources. This needs some thought and planning: You should also use SQL Agent jobs when possible to schedule your server-related tasks. This requires up-front design to prevent them becoming unmanageable monsters prey to ad-hoc growth.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ole.bmp" alt="ole.bmp">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="problems-with-table-design"><a class="anchor" href="#problems-with-table-design"></a>2. Problems with Table Design</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="using-constraints-to-restrict-values-in-a-column"><a class="anchor" href="#using-constraints-to-restrict-values-in-a-column"></a>2.1. Using constraints to restrict values in a column</h3>
<div class="paragraph">
<p>You can use a constraint to restrict the values permitted in a column, but it is usually better to define the values in a separate 'lookup' table and enforce the data restrictions with a foreign key constraint. This makes it much easier to maintain and will also avoid a code-change every time a new value is added to the permitted range, as is the case with constraints.</p>
</div>
</div>
<div class="sect2">
<h3 id="not-using-referential-integrity-constraints"><a class="anchor" href="#not-using-referential-integrity-constraints"></a>2.2. Not using referential integrity constraints</h3>
<div class="paragraph">
<p>One way in which SQL Server maintains data integrity is by using constraints to enforce relationships between tables. The query optimizer can also take advantage of these constraints when constructing query plans. Leaving the constraints off in support of letting the code handle it or avoiding the overhead is a common code smell. It&#8217;s like forgetting to hit the 'turbo' button.</p>
</div>
</div>
<div class="sect2">
<h3 id="enabling-nocheck-on-referential-integrity-constraints"><a class="anchor" href="#enabling-nocheck-on-referential-integrity-constraints"></a>2.3. Enabling NOCHECK on referential integrity constraints</h3>
<div class="paragraph">
<p>Some scripting engines disable referential integrity during updates. You must ensure that WITH CHECK is enabled or else the constraint is marked as untrusted and therefore won&#8217;t be used by the optimizer.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp019"><strong>BP019- Foreign key is disabled</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-too-many-or-too-few-indexes"><a class="anchor" href="#using-too-many-or-too-few-indexes"></a>2.4. Using too many or too few indexes</h3>
<div class="paragraph">
<p>A table in a well-designed database with an appropriate clustered index will have an optimum number of non-clustered indexes, depending on usage. Indexes incur a cost to the system since they must be maintained if data in the table changes. The presence of duplicate indexes and almost-duplicate indexes is a bad sign. So is the presence of unused indexes. SQL Server lets you create completely redundant and totally duplicate indexes. Sometimes this is done in the mistaken belief that the order of 'included' (non-key) columns is significant. It isn&#8217;t!</p>
</div>
</div>
<div class="sect2">
<h3 id="not-choosing-the-most-suitable-clustered-index-for-a-table"><a class="anchor" href="#not-choosing-the-most-suitable-clustered-index-for-a-table"></a>2.5. Not choosing the most suitable clustered index for a table</h3>
<div class="paragraph">
<p>You can only have one clustered index on a table, of course, and this choice has a lot of influence on the performance of queries, so you should take care to select wisely.  Are you likely to select predominately single values, unsorted or sorted ranges? Are you predominately using one particular index other than your primary key? Is the table experiencing many more reads than writes, with queries that make reference to columns that arent part of the primary key? Are you typically selecting ranges within a particular category? Are your WHERE clauses returning many rows? These ways that the table participates in frequently-used queries are likely to be better accommodated by a clustered index.</p>
</div>
<div class="paragraph">
<p>For your clustered index, you are likely to choose a narrow index which is stored economically because this value has to be held in every index leaf-level pointer. This can be an interesting trade-off because the clustered index key is automatically included in all non-clustered indexes as the row locator so non-clustered indexes will cover queries that need only the non-clustered index key and the clustered index key.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp001"><strong>BP001 Index type is not specified</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="not-explicitly-declaring-which-index-is-the-clustered-one."><a class="anchor" href="#not-explicitly-declaring-which-index-is-the-clustered-one."></a>2.6. Not explicitly declaring which index is the clustered one.</h3>
<div class="paragraph">
<p>The primary key is the usual, but not the only, correct choice to be the clustered index. It is seldom wrong to assign a clustered index to a primary key. It is just a problem if your choice of primary key is a fat key without natural order that doesnt work well as a clustered index, or if there is a much better use in the table for that clustered index, such as supporting range scans or avoiding sorts on a frequently-queried candidate key.</p>
</div>
<div class="paragraph">
<p>A Clustered index shouldnt necessarily be frittered away on a surrogate primary key, based on some meaningless ever-increasing integer. Do not be afraid to use the clustered index for another key if it fits better with the way you query the data, and specifically how the table participates in frequently-used queries.You can only have one clustered index on a table, of course, and this choice has a lot of influence on the performance of queries, so you should take care to select wisely. The primary key is the usual, but not the only, correct choice.</p>
</div>
</div>
<div class="sect2">
<h3 id="misusing-null-values"><a class="anchor" href="#misusing-null-values"></a>2.7. Misusing NULL values</h3>
<div class="paragraph">
<p>The three-value logic required to handle NULL values can cause a problems in reporting, computed values and joins. A NULL value means 'unknown', so any sort of mathematics or concatenation will result in an unknown (NULL) value. Table columns should be nullable only when they really need to be. Although it can be useful to signify that the value of a column is unknown or irrelevant for a particular row, NULLs should be permitted only when they&#8217;re legitimate for the data and application, and fenced around to avoid subsequent problems.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-temporary-tables-for-very-small-result-sets"><a class="anchor" href="#using-temporary-tables-for-very-small-result-sets"></a>2.8. Using temporary tables for very small result sets</h3>
<div class="paragraph">
<p>Temporary tables can lead to recompiles, which can be costly. Table variables, while not so useful for larger data sets (approximately 150 rows or more), avoid recompiles and are therefore preferred in smaller data sets.</p>
</div>
<div class="paragraph">
<p><strong>ST011/ST012 Consider using table variable instead of temporary table/Consider using temporary table instead of table variable</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-table-without-specifying-a-schema"><a class="anchor" href="#creating-a-table-without-specifying-a-schema"></a>2.9. Creating a table without specifying a schema</h3>
<div class="paragraph">
<p>If you&#8217;re creating tables from a script, they must, like views and routines, always be defined with two-part names. It is possible for different schemas to contain the same table name, and there are some perfectly legitimate reasons for doing this. Don&#8217;t rely on dbo being the default schema for the login that executes the create script: The default can be changed.</p>
</div>
<div class="paragraph">
<p>The user of any database is defaulted to the dbo schema, unless explicitly assigned to a different schema. Unless objects are referenced by schema as well as name, they are assumed by the database engine to be in the users default schema, and if not there, in the dbo schema.</p>
</div>
</div>
<div class="sect2">
<h3 id="most-tables-should-have-a-clustered-index"><a class="anchor" href="#most-tables-should-have-a-clustered-index"></a>2.10. Most tables should have a clustered index</h3>
<div class="paragraph">
<p>SQL Server storage is built around the clustered index as a fundamental part of the data storage and retrieval engine. The data itself is stored with the clustered key. All this makes having an appropriate clustered index a vital part of database design. The places where a table without a clustered index is preferable are rare; which is why a missing clustered index is a common code smell in database design.</p>
</div>
<div class="paragraph">
<p>A table without a clustered index is actually a heap, which is a particularly bad idea when its data is usually returned in an aggregated form, or in a sorted order. Paradoxically, though, it can be rather good for implementing a log or a staging table used for bulk inserts, since it is read very infrequently, and there is less overhead in writing to it. A table with a non-clustered index , but without a clustered index can sometimes perform well even though the index has to reference individual rows via a Row Identifier rather than a more meaningful clustered index. The arrangement can be effective for a table that isnt often updated if the table is always accessed by a non-clustered index and there is no good candidate for a clustered index.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-same-column-name-in-different-tables-but-with-different-data-types"><a class="anchor" href="#using-the-same-column-name-in-different-tables-but-with-different-data-types"></a>2.11. Using the same column name in different tables but with different data types</h3>
<div class="paragraph">
<p>Any programmer will assume a sane database design in which columns with the same name in different tables have the same data type. As a result, they probably won&#8217;t verify types. Different types is an accident waiting to happen.</p>
</div>
</div>
<div class="sect2">
<h3 id="defining-a-table-column-without-explicitly-specifying-whether-it-is-nullable"><a class="anchor" href="#defining-a-table-column-without-explicitly-specifying-whether-it-is-nullable"></a>2.12. Defining a table column without explicitly specifying whether it is nullable</h3>
<div class="paragraph">
<p>In a CREATE TABLE DDL script, a column definition that has not specified that a column is NULL or NOT NULL is a risk. The default nullability for a database&#8217;s columns can be altered by the 'ANSI_NULL_DFLT_ON' setting. Therefore one cannot assume whether a column will default to NULL or NOT NULL. It is safest to specify it in the column definition for noncomputed columns, and it is essential if you need any portability of your table design. Sparse columns must always allow NULL.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp001"><strong>BP001 [NOT</a> NULL option is not specified in CREATE/DECLARE TABLE statement (registered once per table)</strong>]</p>
</div>
</div>
<div class="sect2">
<h3 id="adding-not-null-column-without-default-value-to-a-table-with-data-will-fail"><a class="anchor" href="#adding-not-null-column-without-default-value-to-a-table-with-data-will-fail"></a>2.13. Trying to add a NOT NULL column without default value to a table with data</h3>
<div class="paragraph">
<p>Adding a NOT NULL column without a DEFAULT value to an existing table with data in it will fail because SQL Server has no way of adding that column to existing rows, because there must be a value in the column.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei028"><strong>EI028 Adding NOT NULL column without default value</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="creating-dated-copies-of-the-same-table-to-manage-table-sizes"><a class="anchor" href="#creating-dated-copies-of-the-same-table-to-manage-table-sizes"></a>2.14. Creating dated copies of the same table to manage table sizes</h3>
<div class="paragraph">
<p>Now that SQL Server supports table partitioning, it is far better to use partitions than to create dated tables, such as Invoices2012, Invoices2013, etc. If old data is no longer used, archive the data, store only aggregations, or both.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="problems-with-data-types"><a class="anchor" href="#problems-with-data-types"></a>3. Problems with Data Types</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="using-varchar1-varchar2-etc."><a class="anchor" href="#using-varchar1-varchar2-etc."></a>3.1. Using VARCHAR(1), VARCHAR(2), etc.</h3>
<div class="paragraph">
<p>Columns of a short or fixed length should have a fixed size because variable-length types have a disproportionate storage overhead. For a large table, this could be significant. The narrow a table, the faster it can be accessed. In addition, columns of variable length are stored after all columns of fixed length, which can have performance implications. For short strings,  use a fixed length type, such as CHAR, NCHAR, and BINARY.</p>
</div>
<div class="paragraph">
<p><strong>BP009 Avoid var types of length 1 or 2</strong>
<a href="https://msdn.microsoft.com/en-us/library/dd193263(v=vs.100).aspx"><strong>SR0009: Avoid using types of variable length that are size 1 or 2</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="declaring-var-type-variables-without-length"><a class="anchor" href="#declaring-var-type-variables-without-length"></a>3.2. Declaring var type variables without length</h3>
<div class="paragraph">
<p>An VARCHAR, VARBINARY or NVARCHAR that is declared without an explicit length is shorthand for specifying a length of 1. Is this what you meant or did you do it by accident? Much better and safer to be explicit.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-deprecated-language-elements-such-as-the-textntext-data-types"><a class="anchor" href="#using-deprecated-language-elements-such-as-the-textntext-data-types"></a>3.3. Using deprecated language elements such as the TEXT/NTEXT data types</h3>
<div class="paragraph">
<p>There is no good reason to use TEXT or NTEXT. They were a first, flawed attempt at BLOB storage and are there only for backward compatibility. Likewise, the WRITETEXT, UPDATETEXT and READTEXT statements are also deprecated. All this complexity has been replaced by the VARCHAR(MAX) and NVARCHAR(MAX) data types, which work with all of SQL Server&#8217;s string functions.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/deprecated-rules/dep002"><strong>DEP002 WRITETEXT,UPDATETEXT and READTEXT statements are deprecated.</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-money-data-type"><a class="anchor" href="#using-money-data-type"></a>3.4. Using MONEY data type</h3>
<div class="paragraph">
<p>The MONEY data type confuses the storage of data values with their display, though it clearly suggests, by its name, the sort of data held. Using the DECIMAL data type is almost always better.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-float-or-real-data-types"><a class="anchor" href="#using-float-or-real-data-types"></a>3.5. <em>Using FLOAT or REAL data types</em></h3>
<div class="paragraph">
<p>The FLOAT (8 byte) and REAL (4 byte) data types are suitable only for specialist scientific use since they are approximate types with an enormous range (-1.79E+308 to -2.23E-308, 0 and 2.23E-308 to 1.79E+308, in the case of FLOAT). Any other use needs to be regarded as suspect, and a FLOAT or REAL used as a key or found in an index needs to be investigated. The DECIMAL type is an exact data type and has an impressive range from -10^38+1 through 10^38-1. Although it requires more storage than the FLOAT or REAL types, it is generally a better choice.</p>
</div>
</div>
<div class="sect2">
<h3 id="mixing-parameter-data-types-in-a-coalesce-expression"><a class="anchor" href="#mixing-parameter-data-types-in-a-coalesce-expression"></a>3.6. Mixing parameter data types in a COALESCE expression</h3>
<div class="paragraph">
<p>The result of the COALESCE expression (which is shorthand for a CASE statement) is the first non-NULL expression in the list of expressions provided as arguments. Mixing data types can result in errors or data truncation.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-datetime-or-datetime2-when-youre-concerned-only-with-the-date"><a class="anchor" href="#using-datetime-or-datetime2-when-youre-concerned-only-with-the-date"></a>3.7. Using DATETIME or DATETIME2 when you&#8217;re concerned only with the date</h3>
<div class="paragraph">
<p>Even with data storage being so cheap, a saving in a data type adds up and makes comparison and calculation easier. When appropriate, use the DATE or SMALLDATETIME type. Narrow tables perform better and use less resources</p>
</div>
</div>
<div class="sect2">
<h3 id="using-datetime-or-datetime2-when-youre-merely-recording-the-time-of-day"><a class="anchor" href="#using-datetime-or-datetime2-when-youre-merely-recording-the-time-of-day"></a>3.8. Using DATETIME or DATETIME2 when you&#8217;re merely recording the time of day</h3>
<div class="paragraph">
<p>Being parsimonious with memory is important for large tables, not only to save space but also to reduce I/O activity during access. When appropriate, use the TIME or SMALLDATETIME type. Queries too are generally simpler on the appropriate data type.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-sql_variant-inappropriately"><a class="anchor" href="#using-sql_variant-inappropriately"></a>3.9. Using sql_variant inappropriately</h3>
<div class="paragraph">
<p>The sql_variant type is not your typical data type. It stores values from a number of different data types and is used internally by SQL Server. It is hard to imagine a valid use in a relational database. It cannot be returned to an application via ODBC except as binary data, and it isn&#8217;t supported in Microsoft Azure SQL Database.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-length-of-the-varchar-varbinary-and-nvarchar-datatype-in-a-cast-or-convert-clause-wasnt-explicitly-specified"><a class="anchor" href="#the-length-of-the-varchar-varbinary-and-nvarchar-datatype-in-a-cast-or-convert-clause-wasnt-explicitly-specified"></a>3.10. The length of the VARCHAR, VARBINARY and NVARCHAR datatype in a CAST or CONVERT clause wasn&#8217;t explicitly specified</h3>
<div class="paragraph">
<p>When you convert a datatype to a varchar, you do not have to specify the length. If you don&#8217;t do so, SQL Server will use a Varchar length sufficient to hold the string. It is better to specify the length because SQL Server has no idea what length you may subsequently need.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp008"><strong>BP008 CAST/CONVERT to var types without length</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="storing-a-duration-rather-than-a-point-in-time"><a class="anchor" href="#storing-a-duration-rather-than-a-point-in-time"></a>3.11. Storing a duration rather than a point in time</h3>
<div class="paragraph">
<p>This takes some programmers by surprise. Although it is possible to store a time interval in a table it is not generally a good idea. A time interval is the difference between the start and end of a period of time. You may want to measure this in all sorts of ways, (milliseconds? Quarters? weeks?) and you may subsequently need to deal with all sorts of queries that have to work out what the status was at a particular time (e.g. how many rooms were booked at a particular point in time). By storing the time period as the start and end date-and-time, you leave your options open. If you store the time interval (in what? Seconds?) and maybe the start DateTime, you make subsequent queries more difficult.
It is possible to use a TIME data type if the duration is less than 24 hours, but this is not what the type is intended for, and can be the cause of confusion for the next person who has to maintain your code. They will display very oddly depending on the representation of the time-of-day you use and wrap around every 24 hours!</p>
</div>
</div>
<div class="sect2">
<h3 id="using-varcharmax-or-nvarcharmax-when-it-isnt-necessary"><a class="anchor" href="#using-varcharmax-or-nvarcharmax-when-it-isnt-necessary"></a>3.12. Using VARCHAR(MAX) or NVARCHAR(MAX) when it isn&#8217;t necessary</h3>
<div class="paragraph">
<p>VARCHAR types that specify a number rather than MAX have a finite maximum length and can be stored in-page, whereas MAX types are treated as BLOBS and stored off-page, preventing online re-indexing. Use MAX only when you need more than 8000 bytes (4000 characters for NVARCHAR, 8000 characters for VARCHAR).</p>
</div>
</div>
<div class="sect2">
<h3 id="using-varchar-rather-than-nvarchar-for-anything-that-requires-internationalisation-such-as-names-or-addresses"><a class="anchor" href="#using-varchar-rather-than-nvarchar-for-anything-that-requires-internationalisation-such-as-names-or-addresses"></a>3.13. Using VARCHAR rather than NVARCHAR for anything that requires internationalisation, such as names or addresses</h3>
<div class="paragraph">
<p>You can&#8217;t require everyone to stop using national characters or accents any more. The nineteen-fifties are long gone. Names are likely to have accents in them if spelled properly, and international addresses and language strings will almost certainly have accents and national characters that can&#8217;t be represented by 8-bit ASCII!</p>
</div>
</div>
<div class="sect2">
<h3 id="declaring-varchar-varbinary-and-nvarchar-datatypes-without-explicit-length"><a class="anchor" href="#declaring-varchar-varbinary-and-nvarchar-datatypes-without-explicit-length"></a>3.14. Declaring VARCHAR, VARBINARY and NVARCHAR datatypes without explicit length</h3>
<div class="paragraph">
<p>An NVARCHAR that is declared without an explicit length is shorthand for specifying a length of 1. Is this what you meant or did you do it by accident? Much better to be explicit.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp007"><strong>BP007 Declaring var type variables without length</strong></a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="problems-with-expressions"><a class="anchor" href="#problems-with-expressions"></a>4. Problems with expressions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="excessive-use-of-parentheses"><a class="anchor" href="#excessive-use-of-parentheses"></a>4.1. Excessive use of parentheses</h3>
<div class="paragraph">
<p>Some developers use parentheses even when they aren&#8217;t necessary, as a safety net when they&#8217;re not sure of precedence. This makes the code more difficult to maintain and understand.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-functions-such-as-isnumeric-without-additional-checks"><a class="anchor" href="#using-functions-such-as-isnumeric-without-additional-checks"></a>4.2. Using functions such as 'ISNUMERIC' without additional checks</h3>
<div class="paragraph">
<p>Some functions, such as ISNUMERIC, are there to tell you in very general terms whether a string can be converted to a number without an error. Sadly, it doesn&#8217;t tell you what kind of number. (Try SELECT isNumeric(','); or SELECT ISNUMERIC('4D177'); for example.) This causes immense confusion. The ISNUMERIC function returns 1 when the input expression evaluates to a valid numeric data type; otherwise it returns 0. The function also returns 1 for some characters that are not numbers, such as plus (+), minus (-), and valid currency symbols such as the dollar sign ($). This is legitimate because these can be converted to numbers, but counter-intuitive. Unfortunately, most programmers want to know whether a number is a valid quantity of money, or a float, or integer. Use a function such as TRY_CAST() and TRY_CONVERT() that is appropriate for the data type whose validity you are testing. E.g. select try_convert(int,'12,345') or select try_convert(float,'5D105')</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei029"><strong>EI029 Avoid using ISNUMERIC() function</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="injudicious-use-of-the-ltrim-and-rtrim-functions"><a class="anchor" href="#injudicious-use-of-the-ltrim-and-rtrim-functions"></a>4.3. Injudicious use of the LTRIM and RTRIM functions</h3>
<div class="paragraph">
<p>These don&#8217;t work as they do in any other computer language. They only trim ASCII space rather than any whitespace character. Use a scalar user-defined function instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-datalength-rather-than-len-to-find-the-length-of-a-string."><a class="anchor" href="#using-datalength-rather-than-len-to-find-the-length-of-a-string."></a>4.4. Using DATALENGTH rather than LEN to find the length of a string.</h3>
<div class="paragraph">
<p>Although using the DATALENGTH function is valid, it can easily give you the wrong results if you&#8217;re unaware of the way it works with the CHAR, NCHAR, or NVARCHAR data types.</p>
</div>
</div>
<div class="sect2">
<h3 id="not-using-a-semicolon-to-terminate-sql-statements"><a class="anchor" href="#not-using-a-semicolon-to-terminate-sql-statements"></a>4.5. Not using a semicolon to terminate SQL statements</h3>
<div class="paragraph">
<p>Although the lack of semicolons is completely forgivable, it helps to understand more complicated code if individual statements are terminated. With one or two exceptions, such as delimiting the previous statement from a CTE, using semicolons is currently only a decoration, though it is a good habit to adopt to make code more future-proof and portable. When developing code, it is usual add clauses on the end of statements, and in these circumstances, semicolons can be a considerable irritation because they trigger etrrors when they become embedded.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/deprecated-rules/dep023"><strong>DEP023 Not ending Transact-SQL statements with a semicolon is deprecated</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="relying-on-data-being-implicitly-converted-between-types"><a class="anchor" href="#relying-on-data-being-implicitly-converted-between-types"></a>4.6. Relying on data being implicitly converted between types</h3>
<div class="paragraph">
<p>Implicit conversions can have unexpected results, such as truncating data or reducing performance. It is not always clear in expressions how differences in data types are going to be resolved. If data is implicitly converted in a join operation, the database engine is more likely to build a poor execution plan. More often then not, you should explicitly define your conversions to avoid unintentional consequences.</p>
</div>
<div class="paragraph">
<p>See: <a href="http://msdn.microsoft.com/en-us/library/dd193269(v=vs.100).aspx">SR0014: Data loss might occur when casting from {Type1} to {Type2}</a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-identity-system-function"><a class="anchor" href="#using-the-identity-system-function"></a>4.7. Using the @@IDENTITY system function</h3>
<div class="paragraph">
<p>The generation of an IDENTITY value is not transactional, so in some circumstances, <strong>@@IDENTITY</strong> returns the wrong value and not the value from the row you just inserted. This is especially true when using triggers that insert data, depending on when the triggers fire. The <strong>SCOPE_IDENTITY</strong> function is safer because it always relates to the current batch (within the same scope). Also consider using the IDENT_CURRENT function, which returns the last IDENTITY value regardless of session or scope. The <strong>OUTPUT</strong> clause is a better and safer way of capturing identity values.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp010"><strong>BP010 Usage of @@identity</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-between-for-datetime-ranges"><a class="anchor" href="#using-between-for-datetime-ranges"></a>4.8. Using BETWEEN for DATETIME ranges</h3>
<div class="paragraph">
<p>You never get complete accuracy if you specify dates when using the BETWEEN logical operator with DATETIME values, due to the inclusion of both the date and time values in the range. It is better to first use a date function such as DATEPART to convert the DATETIME value into the necessary granularity (such as day, month, year, day of year) and store this in a column (or columns), then indexed and used as a filtering or grouping value. This can be done by using a persisted computed column to store the required date part as an integer, or via a trigger.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-select-in-a-batch"><a class="anchor" href="#using-select-in-a-batch"></a>4.9. Using SELECT * in a batch</h3>
<div class="paragraph">
<p>Although there is a legitimate use in a batch for IF EXISTS (SELECT * FROM  &#8230;&#8203; ) or SELECT count(*), any other use is vulnerable to changes in column names or order. SELECT * was designed for interactive use, not as part of a batch. It assumes certain columns in a particular order, which may not last. Also, results should always consist of just the columns you need. Plus, requesting more columns from the database than are used by the application results in excess database I/O and network traffic, leading to slow application response and unhappy users.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp005"><strong>BP005 Asterisk in select list</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="insert-without-column-list"><a class="anchor" href="#insert-without-column-list"></a>4.10. INSERT without column list</h3>
<div class="paragraph">
<p>The INSERT statement need not have a column list, but omitting it assumes certain columns in a particular order. It likely to cause errors if the table in to which the inserts will be made is changed, particularly with table variables where insertions are not checked. Column lists also make code more intelligible</p>
</div>
<div class="paragraph">
<p>See: <a href="http://msdn.microsoft.com/en-us/library/dd193296(v=vs.100).aspx" class="bare">http://msdn.microsoft.com/en-us/library/dd193296(v=vs.100).aspx</a>[SR0001: Avoid SELECT * in a batch, stored procedures, views, and table-valued functions*</p>
</div>
</div>
<div class="sect2">
<h3 id="order-by-clause-with-constants"><a class="anchor" href="#order-by-clause-with-constants"></a>4.11. ORDER BY clause with constants</h3>
<div class="paragraph">
<p>The use of constants in the ORDER BY is deprecated for removal in the future. They make ORDER BY statements more difficult to understand.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp002"><strong>BP002 ORDER BY clause with constants</strong></a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="difficulties-with-query-syntax"><a class="anchor" href="#difficulties-with-query-syntax"></a>5. Difficulties with Query Syntax</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="creating-uberqueries-god-like-queries"><a class="anchor" href="#creating-uberqueries-god-like-queries"></a>5.1. Creating UberQueries (God-like Queries)</h3>
<div class="paragraph">
<p>Always avoid overweight queries (e.g., a single query with four inner joins, eight left joins, four derived tables, ten subqueries, eight clustered GUIDs, two UDFs and six case statements).</p>
</div>
</div>
<div class="sect2">
<h3 id="nesting-views-as-if-they-were-russian-dolls"><a class="anchor" href="#nesting-views-as-if-they-were-russian-dolls"></a>5.2. Nesting views as if they were Russian dolls</h3>
<div class="paragraph">
<p>Views are important for abstracting the base tables. However, they do not lend themselves to being deeply nested. Views that reference views that reference views that reference views perform poorly and are difficult to maintain. Recommendations vary but I suggest that views relate directly to base tables where possible.</p>
</div>
</div>
<div class="sect2">
<h3 id="joins-between-large-views"><a class="anchor" href="#joins-between-large-views"></a>5.3. Joins between large views</h3>
<div class="paragraph">
<p>Views are like tables in their behaviour, but they can&#8217;t be indexed to support joins. When large views participate in joins, you never get good performance. Instead, either create a view that joins the appropriately indexed base tables, or create indexed temporary tables to contain the filtered rows from the views you wish to 'join'.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-old-sybase-join-syntax"><a class="anchor" href="#using-the-old-sybase-join-syntax"></a>5.4. Using the old Sybase JOIN syntax</h3>
<div class="paragraph">
<p>The deprecated syntax (which includes defining the join condition in the WHERE clause) is not standard SQL and is more difficult to inspect and maintain. Parts of this syntax are completely unsupported in SQL Server 2012 or higher.<a id="_Toc395168942"></a></p>
</div>
<div class="paragraph">
<p>The old style Microsoft/Sybase JOIN style for SQL, which uses the =* and *= syntax, has been deprecated and is no longer used. Queries that use this syntax will fail when the database engine level is 10 (SQL Server 2008) or later (compatibility level 100). The ANSI-89 table citation list (FROM tableA, tableB) is still ISO standard for INNER JOINs only. Neither of these styles are worth using. It is always better to specify the type of join you require, INNER, LEFT OUTER, RIGHT OUTER, FULL OUTER and CROSS, which has been standard since ANSI SQL-92 was published. While you can choose any supported JOIN style, without affecting the query plan used by SQL Server, using the ANSI-standard syntax will make your code easier to understand, more consistent, and portable to other relational database systems.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://www.red-gate.com/hub/product-learning/sql-prompt/finding-code-smells-using-sql-prompt-old-style-join-syntax-st001">old-style join syntax</a></p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/deprecated-rules/dep017"><strong>DEP017 NON-ANSI join (</strong>== or =*) is used</a></p>
</div>
<div class="paragraph">
<p><strong>ST001 Old-style join is used (&#8230;&#8203;from table1,table2&#8230;&#8203;)</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="using-correlated-subqueries-instead-of-a-join"><a class="anchor" href="#using-correlated-subqueries-instead-of-a-join"></a>5.5. Using correlated subqueries instead of a join</h3>
<div class="paragraph">
<p>Correlated subqueries, queries that run against each returned by the main query, sometimes seem an intuitive approach, but they are merely disguised cursors needed only in exceptional circumstances. Window functions will usually perform the same operations much faster. Most usages of correlated subqueries are accidental and can be replaced with a much simpler and faster JOIN query.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-select-rather-than-set-to-assign-values-to-variables"><a class="anchor" href="#using-select-rather-than-set-to-assign-values-to-variables"></a>5.6. Using SELECT rather than SET to assign values to variables</h3>
<div class="paragraph">
<p>Using a SELECT statement to assign variable values is not ANSI standard SQL and can result in unexpected results. If you try to assign the result from a single query to a scalar variable, and the query produces several rows, a SELECT statement will return no errors, whereas a SET statement will. On the other hand, if the query returns no rows, the SET statement will assign a NULL to the variable, whereas SELECT will leave the current value of the variable intact.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-scalar-user-defined-functions-udfs-for-data-lookups-as-a-poor-mans-join."><a class="anchor" href="#using-scalar-user-defined-functions-udfs-for-data-lookups-as-a-poor-mans-join."></a>5.7. Using scalar user-defined functions (UDFs) for data lookups as a poor man&#8217;s join.</h3>
<div class="paragraph">
<p>It is true that SQL Server provides a number of system functions to simplify joins when accessing metadata, but these are heavily optimised. Using user-defined functions in the same way will lead to very slow queries since they perform much like correlated subqueries.</p>
</div>
</div>
<div class="sect2">
<h3 id="not-using-two-part-object-names-for-object-references"><a class="anchor" href="#not-using-two-part-object-names-for-object-references"></a>5.8. Not using two-part object names for object references</h3>
<div class="paragraph">
<p>The compiler can interpret a two-part object name quicker than just one name. This applies particularly to tables, views, procedures and functions. The same name can be used in different schemas, so it pays to make your queries unambiguous.</p>
</div>
<div class="paragraph">
<p>The complete name of any schema-based database object consists of up to four identifiers: the server name, database name, schema name, and object name. Only if you are calling a remote stored procedure would you need a fully qualified name consisting of all four identifiers. If you are calling a procedure in another database, you obviously need its database identifier in the name. Within a database, you only need the object name itself so long as the procedure is in the same schema. By specifying the schema, the database engine needs less searching to identify it. Even system stored procedures should be qualified with the sys schema name. When creating a stored procedure as well, it is a good habit to always specify the parent schema.</p>
</div>
<div class="paragraph">
<p>It is a very good idea to get into the habit of qualifying the names of procedures with their schema. It is not only makes your code more resilient and maintainable, but as Microsoft introduces new features that use schemas, such as auditing mechanisms, you code contains no ambiguities that could cause problems.</p>
</div>
<div class="paragraph">
<p>See:  <a href="https://www.red-gate.com/hub/product-learning/sql-prompt/finding-code-smells-using-sql-prompt-procedures-lack-schema-qualification">procedures that lack schema-qualification</a></p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/performance-rules/pe001"><strong>PE001/PE002 Schema name for procedure is not specified/Schema name for table or view is not specified</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-insert-into-without-specifying-the-columns-and-their-order"><a class="anchor" href="#using-insert-into-without-specifying-the-columns-and-their-order"></a>5.9. Using INSERT INTO without specifying the columns and their order</h3>
<div class="paragraph">
<p>Not specifying column names is fine for interactive work, but if you write code that relies on the hope that nothing will ever change, then refactoring could prove to be impossible. It is much better to trigger an error now than to risk corrupted results after the SQL code has changed. Column lists also make code more intelligible</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp004"><strong>BP004 INSERT without column list</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-full-outer-joins-unnecessarily."><a class="anchor" href="#using-full-outer-joins-unnecessarily."></a>5.10. Using full outer joins unnecessarily.</h3>
<div class="paragraph">
<p>It is rare to require both matched and unmatched rows from the two joined tables, especially if you filter out the unmatched rows in the WHERE clause. If what you really need is an inner join, left outer join or right outer join, then use one of those. If you want all rows from both tables, use a cross join.</p>
</div>
</div>
<div class="sect2">
<h3 id="including-complex-conditionals-in-the-where-clause"><a class="anchor" href="#including-complex-conditionals-in-the-where-clause"></a>5.11. Including complex conditionals in the WHERE clause</h3>
<div class="paragraph">
<p>It is tempting to produce queries in routines that have complex conditionals in the WHERE clause where variables are used for filtering rows. Usually this is done so that a range of filtering conditions can be passed as parameters to a stored procedure or tale-valued function. If a variable is set to NULL instead of a search term, the OR logic or a COALESCE disables the condition. If this is used in a routine, very different queries are performed according to the combination of parameters used or set to null. As a result, the query optimizer must use table scans, and you end up with slow-running queries that are hard to understand or refactor. This is a variety of UberQuery which is usually found when some complex processing is required to achieve the final result from the filtered rows.</p>
</div>
</div>
<div class="sect2">
<h3 id="mixing-data-types-in-joins-or-where-clauses"><a class="anchor" href="#mixing-data-types-in-joins-or-where-clauses"></a>5.12. Mixing data types in joins or WHERE clauses</h3>
<div class="paragraph">
<p>If you compare or join columns that have different data types, you rely on implicit conversions, which result in a poor execution plans that use table scans. This approach can also lead to errors because no constraints are in place to ensure the data is the correct type.</p>
</div>
</div>
<div class="sect2">
<h3 id="assuming-that-select-statements-all-have-roughly-the-same-execution-time"><a class="anchor" href="#assuming-that-select-statements-all-have-roughly-the-same-execution-time"></a>5.13. Assuming that SELECT statements all have roughly the same execution time</h3>
<div class="paragraph">
<p>Few programmers admit to this superstition, but it is apparent by the strong preference for hugely long SELECT statements (sometimes called UberQueries). A simple SELECT statement runs in just a few milliseconds. A process runs faster if the individual SQL queries are clear enough to be easily processed by the query optimizer. Otherwise, you will get a poor query plan that performs slowly and won&#8217;t scale.</p>
</div>
</div>
<div class="sect2">
<h3 id="not-handling-null-values-in-nullable-columns"><a class="anchor" href="#not-handling-null-values-in-nullable-columns"></a>5.14. Not handling NULL values in nullable columns</h3>
<div class="paragraph">
<p>Generally, it is wise to explicitly handle NULLs in nullable columns, by using COALESCE to provide a default value. This is especially true when calculating or concatenating the results. (A NULL in part of a concatenated string, for example, will propagate to the entire string. Names and addresses are prone to this sort of error.)</p>
</div>
<div class="paragraph">
<p><a href="http://msdn.microsoft.com/en-us/library/dd193267(v=vs.100).aspx" class="bare">http://msdn.microsoft.com/en-us/library/dd193267(v=vs.100).aspx</a>[SR0007: Use ISNULL(column, default_value) on nullable columns in expressions*</p>
</div>
</div>
<div class="sect2">
<h3 id="referencing-an-unindexed-column-within-the-in-predicate-of-a-where-clause"><a class="anchor" href="#referencing-an-unindexed-column-within-the-in-predicate-of-a-where-clause"></a>5.15. Referencing an unindexed column within the IN predicate of a WHERE clause</h3>
<div class="paragraph">
<p>A WHERE clause that references an unindexed column in the IN predicate causes a table scan and is therefore likely to run far more slowly than necessary.</p>
</div>
<div class="paragraph">
<p>See: <a href="http://msdn.microsoft.com/en-us/library/dd193249(v=vs.100).aspx" class="bare">http://msdn.microsoft.com/en-us/library/dd193249(v=vs.100).aspx</a>[SR0004: Avoid using columns that do not have indexes as test expressions in IN predicates*</p>
</div>
</div>
<div class="sect2">
<h3 id="using-like-in-a-where-clause-with-an-initial-wildcard-character"><a class="anchor" href="#using-like-in-a-where-clause-with-an-initial-wildcard-character"></a>5.16. Using LIKE in a WHERE clause with an initial wildcard character</h3>
<div class="paragraph">
<p>An index cannot be used to find matches that start with a wildcard character ('%' or '_' ), so queries are unlikely to run well on large tables because they&#8217;ll require table scans.</p>
</div>
<div class="paragraph">
<p>See: <a href="http://msdn.microsoft.com/en-us/library/dd193273(v=vs.100).aspx" class="bare">http://msdn.microsoft.com/en-us/library/dd193273(v=vs.100).aspx</a>[SR0005: Avoid using patterns that start with a '%' in LIKE predicates*</p>
</div>
</div>
<div class="sect2">
<h3 id="using-a-predicate-or-join-column-as-a-parameter-for-a-user-defined-function"><a class="anchor" href="#using-a-predicate-or-join-column-as-a-parameter-for-a-user-defined-function"></a>5.17. Using a predicate or join column as a parameter for a user-defined function</h3>
<div class="paragraph">
<p>The query optimizer will not be able to generate a reasonable query plan if the columns in a predicate or join are included as function parameters. The optimizer needs to be able to make a reasonable estimate of the number of rows in an operation in order to effectively run a SQL statement and cannot do so when functions are used on predicate or join columns.</p>
</div>
</div>
<div class="sect2">
<h3 id="supplying-object-names-without-specifying-the-schema"><a class="anchor" href="#supplying-object-names-without-specifying-the-schema"></a>5.18. Supplying object names without specifying the schema</h3>
<div class="paragraph">
<p>Object names need only to be unique within a schema. However, when referencing an object in a SELECT, UPDATE, DELETE, MERGE or EXECUTE statementor when calling the OBJECT_ID functionthe database engine can find the objects more easily found if the names are qualified with the schema name.</p>
</div>
<div class="paragraph">
<p><strong>PE001/PE002 Schema name for procedure is not specified/Schema name for table or view is not specified</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="using-null-or-null-to-filter-a-nullable-column-for-nulls"><a class="anchor" href="#using-null-or-null-to-filter-a-nullable-column-for-nulls"></a>5.19. Using '== NULL' or '&lt;&gt; NULL' to filter a nullable column for NULLs</h3>
<div class="paragraph">
<p>An expression that returns a NULL as either the left value (Lvalue) or right value (Rvalue) will always evaluate to NULL. Use IS NULL or IS NOT NULL.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp011"><strong>BP011 NULL comparison or addition/substring</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="not-using-nocount-on-in-stored-procedures-and-triggers"><a class="anchor" href="#not-using-nocount-on-in-stored-procedures-and-triggers"></a>5.20. Not using NOCOUNT ON in stored procedures and triggers</h3>
<div class="paragraph">
<p>Unless you need to return messages that give you the row count of each statement, you should specify the NOCOUNT ON option to explicitly turn off this feature. This option is not likely to be a significant performance factor one way or the other.
Whenever you execute a query, a short message is returned to the client with the number of rows that are affected by that T-SQL statement. When you use SET NOCOUNT ON, this message is not sent. This can improve performance by reducing network traffic slightly. It is best to use SET NOCOUNT ON in SQL Server triggers and stored procedures, unless one or more of the applications using the stored procedures require it to be OFF, because they are reading the value in the message.</p>
</div>
<div class="paragraph">
<p>The best approach, generally, is to prevent rowcount messages being sent, unless they are required, but the tricky part is accommodating legacy applications that use, and often misuse, these messages. Additionally, sending these messages can sometimes be a problem for asynchronous processing of procedures by intermediate layers of database applications such as ORMs. The rowcount messages are much slower to be transmitted to the client than the result of the stored procedure, and this can block threads.</p>
</div>
<div class="paragraph">
<p>See <a href="https://www.red-gate.com/hub/product-learning/sql-prompt/finding-code-smells-using-sql-prompt-set-nocount-problem-pe008-pe009">the SET NOCOUNT problem</a></p>
</div>
<div class="paragraph">
<p><strong>PE009 No SET NOCOUNT ON before DML</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-not-in-predicate-in-the-where-clause"><a class="anchor" href="#using-the-not-in-predicate-in-the-where-clause"></a>5.21. Using the NOT IN predicate in the WHERE clause</h3>
<div class="paragraph">
<p>You&#8217;re queries will often perform poorly if your WHERE clause includes a NOT IN predicate that references a subquery. The optimizer will likely have to use a table scan instead of an index seek, even if there is a suitable index. You can almost always get a better-performing query by using a left outer join and checking for a NULL in a suitable NOT NULLable column on the right-hand side.</p>
</div>
</div>
<div class="sect2">
<h3 id="defining-foreign-keys-without-a-supporting-index"><a class="anchor" href="#defining-foreign-keys-without-a-supporting-index"></a>5.22. Defining foreign keys without a supporting index</h3>
<div class="paragraph">
<p>Unlike some relational database management systems (RDBMSs), SQL Server does not automatically index a foreign key column, even though an index will likely be needed. It is left to the implementers of the RDBMS as to whether an index is automatically created to support a foreign key constraint. SQL Server chooses not to do so, probably because, if the referenced table is a lookup table with just a few values, an index isn&#8217;t useful. SQL Server also does not mandate a NOT NULL constraint on the foreign key, perhaps to allow rows that aren&#8217;t related to the referenced table.</p>
</div>
<div class="paragraph">
<p>Even if you&#8217;re not joining the two tables via the primary and foreign keys, with a table of any size, an index is usually necessary to check changes to PRIMARY KEY constraints against referencing FOREIGN KEY constraints in other tables to verify that changes to the primary key are reflected in the foreign key</p>
</div>
</div>
<div class="sect2">
<h3 id="using-a-non-sargable-search-argument..able-expression-in-a-where-clause"><a class="anchor" href="#using-a-non-sargable-search-argument..able-expression-in-a-where-clause"></a>5.23. Using a non-SARGable (Search ARGument..able) expression in a WHERE clause</h3>
<div class="paragraph">
<p>In the WHERE clause of a query it is good to avoid having a column reference or variable embedded within an expression, or used as a parameter of a function. A column reference or variable is best used as a single element on one side of the comparison operator , otherwise it will most probably trigger a table scan, which is expensive in a table of any size.</p>
</div>
<div class="paragraph">
<p>See: <a href="http://msdn.microsoft.com/en-us/library/dd193264(v=vs.100).aspx" class="bare">http://msdn.microsoft.com/en-us/library/dd193264(v=vs.100).aspx</a>[SR0006: Move a column reference to one side of a comparison operator to use a column index*</p>
</div>
</div>
<div class="sect2">
<h3 id="including-a-deterministic-function-in-a-where-clause"><a class="anchor" href="#including-a-deterministic-function-in-a-where-clause"></a>5.24. Including a deterministic function in a WHERE clause</h3>
<div class="paragraph">
<p>If the value of the function does not depend on the data row that you wish to select, then it is better to put its value in a variable before the SELECT query and use the variable instead.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/performance-rules/pe017"><strong>PE017 Incorrect usage of const UDF</strong></a></p>
</div>
<div class="paragraph">
<p>See: <a href="http://msdn.microsoft.com/en-us/library/dd193285(v=vs.100).aspx" class="bare">http://msdn.microsoft.com/en-us/library/dd193285(v=vs.100).aspx</a>[SR0015: Extract deterministic function calls from WHERE predicates*</p>
</div>
</div>
<div class="sect2">
<h3 id="trueusing-an-unverified-scalar-user-defined-function-as-a-constant"><a class="anchor" href="#trueusing-an-unverified-scalar-user-defined-function-as-a-constant"></a>5.25. Using an unverified  scalar user-defined function as a constant.</h3>
<div class="paragraph">
<p>The incorrect use of a scalar UDF that hasn&#8217;t been Schemabound as a global database constant is a major performance problem and must be winkled out of any production code. The problem arises because SQL Server doesnt trust non-schema verified scalar functions as being precise and deterministic, and so chooses the safest, though slowest, option when executing them. Its a slightly insidious problem because it doesnt really show its full significance in the execution plan, though an Extended Events session will reveal what is really going on.</p>
</div>
<div class="paragraph">
<p>See: <a href="https://www.red-gate.com/hub/product-learning/sql-prompt/misuse-scalar-user-defined-function-constant-pe017">Misuse of the scalar user-defined function as a constant (PE017)</a></p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/performance-rules/pe017"><strong>PE017 Incorrect usage of const UDF</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-select-distinct-to-mask-a-join-problem"><a class="anchor" href="#using-select-distinct-to-mask-a-join-problem"></a>5.26. Using SELECT DISTINCT to mask a join problem</h3>
<div class="paragraph">
<p>It is tempting to use SELECT DISTINCT to eliminate duplicate rows in a join. However, it&#8217;s much better to determine why rows are being duplicated and fix the problem.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-not-in-with-an-expression-that-allows-null-values"><a class="anchor" href="#using-not-in-with-an-expression-that-allows-null-values"></a>5.27. Using NOT IN with an expression that allows null values</h3>
<div class="paragraph">
<p>If you are using a NOT IN predicate to select only those rows that match the results returned by a subquery or expression, make sure there are no NULL values in those results. Otherwise, your outer query won&#8217;t return the results you expect. In the case of both IN and NOT IN, it is better to use an appropriate outer join.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/performance-rules/pe019"><strong>PE019 Consider using [NOT</a> EXISTS instead of [NOT] IN (subquery)</strong>]</p>
</div>
<div class="paragraph">
<p>See <a href="https://www.red-gate.com/hub/product-learning/sql-prompt/consider-using-not-exists-instead-not-subquery">Consider using NOT EXISTS instead of NOT IN (subquery)</a></p>
</div>
</div>
<div class="sect2">
<h3 id="a-delete-statement-has-omitted-that-where-clause-which-would-delete-the-whole-table"><a class="anchor" href="#a-delete-statement-has-omitted-that-where-clause-which-would-delete-the-whole-table"></a>5.28. A DELETE statement has omitted that WHERE clause, which would delete the whole table</h3>
<div class="paragraph">
<p>It is very easy to delete an entire table when you mean to delete just one or more rows. There are occasionally good reasons for using DELETE to clear a table entirely. If you need to clear a table that is involved in replication or log shipping, or a table that has foreign key constraints that reference it, you have no choice. Otherwise, it is more usual to use the TRUNCATE TABLE statement that quickly deletes all records in a table by deallocating the data pages used by the table. The DELETE statement logs the deletions, aand establishes locks whereas the TRUNCATE statement only uses the transaction log to record the page deallocation. It also resets the IDENTITY back to the SEED, and the deallocated pages are recycled.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp017"><strong>BP017 DELETE statement without WHERE clause</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="an-update-statement-has-omitted-the-where-clause-which-would-update-every-row-in-the-table"><a class="anchor" href="#an-update-statement-has-omitted-the-where-clause-which-would-update-every-row-in-the-table"></a>5.29. An UPDATE statement has omitted the WHERE clause, which would update every row in the table</h3>
<div class="paragraph">
<p>It is very easy to update an entire table, over-writing the data in it, when you mean to update just one or more rows. At the console, Delete or Update statements should also be in a transaction so you can check the result before committing.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp018"><strong>BP018 UPDATE statement without WHERE clause</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="trueusing-a-common-table-expression-cte-unnecessarily"><a class="anchor" href="#trueusing-a-common-table-expression-cte-unnecessarily"></a>5.30. Using a Common Table Expression (CTE) unnecessarily</h3>
<div class="paragraph">
<p>CTEs are there to make SQL Statements clearer. They specify a temporary named result set,  derived from a simple query and defined within the execution scope of a single SELECT, INSERT, UPDATE, or DELETE statement. They are convenient to use when an intermediate temporary result needs to be used more than once as a table-source within an expression. It is also useful for recursive statements because a common table expression can include references to itself. However, when neither of these rather rare requirements exist, a CTE becomes unnecessary and does nothing but provide extra overhead. It will slow down the performance.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="problems-with-naming"><a class="anchor" href="#problems-with-naming"></a>6. Problems with naming</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="excessively-long-or-short-identifiers"><a class="anchor" href="#excessively-long-or-short-identifiers"></a>6.1. Excessively long or short identifiers</h3>
<div class="paragraph">
<p>Identifiers should help to make SQL readable as if it were English. Short names like t1 or gh might make typing easier but can cause errors and don&#8217;t help teamwork. At the same time, names should be names and not long explanations. Remember that these are names, not documentation. Long names can be frustrating to the person using SQL interactively, unless that person is using SQL Prompt or some other IntelliSense system, through you can&#8217;t rely on it.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-sp_-prefixes-for-stored-procedures"><a class="anchor" href="#using-sp_-prefixes-for-stored-procedures"></a>6.2. Using sp_ prefixes for stored procedures</h3>
<div class="paragraph">
<p>The sp_ prefix has a special meaning in SQL Server and doesn&#8217;t mean 'stored procedure' but 'special', which tells the database engine to first search the master database for the object.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei024"><strong>EI024 Stored procedure name starts with sp_</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="tibbling-sql-server-objects-with-reverse-hungarian-prefixes-such-as-tbl_-vw_-pk_-fn_-and-usp_"><a class="anchor" href="#tibbling-sql-server-objects-with-reverse-hungarian-prefixes-such-as-tbl_-vw_-pk_-fn_-and-usp_"></a>6.3. 'Tibbling' SQL Server objects with Reverse-Hungarian prefixes such as tbl_, vw_, pk_, fn_, and usp_</h3>
<div class="paragraph">
<p>SQL names don&#8217;t need prefixes because there isn&#8217;t any ambiguity about what they refer to. 'Tibbling' is a habit that came from databases imported from Microsoft Access.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-reserved-words-in-names"><a class="anchor" href="#using-reserved-words-in-names"></a>6.4. Using reserved words in names</h3>
<div class="paragraph">
<p>Using reserved words makes code more difficult to read, can cause problems to code formatters, and can cause errors when writing code.</p>
</div>
<div class="paragraph">
<p>See: <a href="http://msdn.microsoft.com/en-us/library/dd193421(v=vs.100).aspx" class="bare">http://msdn.microsoft.com/en-us/library/dd193421(v=vs.100).aspx</a>[SR0012: Avoid using reserved words for type names*</p>
</div>
</div>
<div class="sect2">
<h3 id="including-special-characters-in-object-names"><a class="anchor" href="#including-special-characters-in-object-names"></a>6.5. Including special characters in object names</h3>
<div class="paragraph">
<p>SQL Server supports special character in object names for backward compatibility with older databases such as Microsoft Access, but using these characters in newly created databases causes more problems than they&#8217;re worth. Special characters requires brackets (or double quotations) around the object name, makes code difficult to read, and makes the object more difficult to reference. Avoid particularly using any whitespace characters, square brackets or either double or single quotation marks as part of the object name.</p>
</div>
<div class="paragraph">
<p>See: <a href="http://msdn.microsoft.com/en-us/library/dd172134(v=vs.100).aspx" class="bare">http://msdn.microsoft.com/en-us/library/dd172134(v=vs.100).aspx</a>[R0011: Avoid using special characters in object names*</p>
</div>
</div>
<div class="sect2">
<h3 id="using-numbers-in-table-names"><a class="anchor" href="#using-numbers-in-table-names"></a>6.6. Using numbers in table names</h3>
<div class="paragraph">
<p>It should always serve as a warning to see tables named Year1, Year2, Year3 or so on, or even worse, automatically generated names such as tbl3546 or 567Accounts. If the name of the table doesn&#8217;t describe the entity, there is a design problem</p>
</div>
</div>
<div class="sect2">
<h3 id="see-sr0011-avoid-using-special-characters-in-object-names"><a class="anchor" href="#see-sr0011-avoid-using-special-characters-in-object-names"></a>6.7. See: <a href="http://msdn.microsoft.com/en-us/library/dd172134(v=vs.100).aspx" class="bare">http://msdn.microsoft.com/en-us/library/dd172134(v=vs.100).aspx</a>[SR0011: Avoid using special characters in object names*</h3>

</div>
<div class="sect2">
<h3 id="using-square-brackets-unnecessarily-for-object-names"><a class="anchor" href="#using-square-brackets-unnecessarily-for-object-names"></a>6.8. Using square brackets unnecessarily for object names</h3>
<div class="paragraph">
<p>If object names are valid and not reserved words, there is no need to use square brackets. Using invalid characters in object names is a code smell anyway, so there is little point in using them. If you can&#8217;t avoid brackets, use them only for invalid names.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-system-generated-object-names-particularly-for-constraints"><a class="anchor" href="#using-system-generated-object-names-particularly-for-constraints"></a>6.9. Using system-generated object names, particularly for constraints</h3>
<div class="paragraph">
<p>This tends to happen with primary keys and foreign keys if, in the data definition language (DDL), you don&#8217;t supply the constraint name. Auto-generated names are difficult to type and easily confused, and they tend to confuse SQL comparison tools. When installing SharePoint via the GUI, the database names get GUID suffixes, making them very difficult to deal with.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="problems-with-routines"><a class="anchor" href="#problems-with-routines"></a>7. Problems with routines</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="including-few-or-no-comments"><a class="anchor" href="#including-few-or-no-comments"></a>7.1. Including few or no comments</h3>
<div class="paragraph">
<p>Being antisocial is no excuse. Either is being in a hurry. Your scripts should be filled with relevant comments, 30% at a minimum. This is not just to help your colleagues, but also to help you-in-the-future. What seems obvious today will be as clear as mud tomorrow, unless you comment your code properly. In a routine, comments should include intro text in the header as well as examples of usage.</p>
</div>
</div>
<div class="sect2">
<h3 id="you-have-a-stored-procedure-that-does-not-return-a-result-code"><a class="anchor" href="#you-have-a-stored-procedure-that-does-not-return-a-result-code"></a>7.2. You have a stored procedure that does not return a result code</h3>
<div class="paragraph">
<p>When you use the EXECUTE command to execute a stored procedure, or call the stored procedure from an application, an integer is returned that can be assigned to a variable. It is generally used to communicate the success of the operation. It provides a very useful way of reacting to problems in a process and can make a batch process far less convoluted</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp016"><strong>BP016 Return without result code</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="excessively-overloading-routines"><a class="anchor" href="#excessively-overloading-routines"></a>7.3. Excessively 'overloading' routines</h3>
<div class="paragraph">
<p>Stored procedures and functions are compiled with query plans. If your routine includes multiple queries and you use a parameter to determine which query to run, the query optimizer cannot come up with an efficient execution plan. Instead, break the code into a series of procedures with one 'wrapper' procedure that determines which of the others to run.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-routines-especially-stored-procedures-as-god-routines-or-uberprocs"><a class="anchor" href="#creating-routines-especially-stored-procedures-as-god-routines-or-uberprocs"></a>7.4. Creating routines (especially stored procedures) as 'God Routines' or 'UberProcs'</h3>
<div class="paragraph">
<p>Occasionally, long routines provide the most efficient way to execute a process, but occasionally they just grow like algae as functionality is added. They are difficult to maintain and likely to be slow. Beware particularly of those with several exit points and different types of result set.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-stored-procedures-that-return-more-than-one-result-set"><a class="anchor" href="#creating-stored-procedures-that-return-more-than-one-result-set"></a>7.5. Creating stored procedures that return more than one result set</h3>
<div class="paragraph">
<p>Although applications can use stored procedures that return multiple result sets, the results cannot be accessed within SQL. Although they can be used by the application via ODBC, the order of tables will be significant and changing the order of the result sets in a refactoring will then break the application in ways that may not even cause an error, and will be difficult to test automatically from within SQL.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-multi-statement-table-valued-function-or-a-scalar-function-when-an-inline-function-is-possible"><a class="anchor" href="#creating-a-multi-statement-table-valued-function-or-a-scalar-function-when-an-inline-function-is-possible"></a>7.6. Creating a Multi-statement table-valued function, or a scalar function when an inline function is possible</h3>
<div class="paragraph">
<p>Inline table-valued Functions run much quicker than a Multi-statement table-valued function, and are also quicker than scalar functions. Obviously, they are only possible where a process can be resolved into a single query.</p>
</div>
</div>
<div class="sect2">
<h3 id="too-many-parameters-in-stored-procedures-or-functions"><a class="anchor" href="#too-many-parameters-in-stored-procedures-or-functions"></a>7.7. Too many parameters in stored procedures or functions</h3>
<div class="paragraph">
<p>The general consensus is that a lot of parameters can make a routine unwieldy and prone to errors. You can use table-valued parameters (TVPs) or XML parameters when it is essential to pass data structures or lists into a routine.</p>
</div>
</div>
<div class="sect2">
<h3 id="duplicated-code"><a class="anchor" href="#duplicated-code"></a>7.8. Duplicated code</h3>
<div class="paragraph">
<p>This is a generic code smell. If you discover an error in code that has been duplicated, the error needs to be fixed in several places. Although duplication of code In SQL is often a code smell, it is not necessarily so. Duplication is sometimes done intentionally where large result sets are involved because generic routines frequently don&#8217;t perform well. Sometimes quite similar queries require very different execution plans. There is often a trade-off between structure and performance, but sometimes the performance issue is exaggerated. Although you can get a performance hit from using functions and procedures to prevent duplication by encapsulating functionality, it isn&#8217;t often enough to warrant deliberate duplication of code</p>
</div>
</div>
<div class="sect2">
<h3 id="high-cyclomatic-complexity"><a class="anchor" href="#high-cyclomatic-complexity"></a>7.9. High cyclomatic complexity</h3>
<div class="paragraph">
<p>Sometimes it is important to have long procedures, maybe with many code routes. However, if a high proportion of your procedures or functions are excessively complex, you&#8217;ll likely have trouble identifying the atomic processes within your application. A high average cyclomatic complexity in routines is a good sign of technical debt.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-an-order-by-clause-within-a-view"><a class="anchor" href="#using-an-order-by-clause-within-a-view"></a>7.10. Using an ORDER BY clause within a view</h3>
<div class="paragraph">
<p>You cannot use the ORDER BY clause without the TOP clause or the OFFSET &#8230;&#8203; FETCH clause in views (or inline functions, derived tables, or subqueries). Even if you resort to using the TOP 100% trick, the resulting order isn&#8217;t guaranteed. Specify the ORDER BY clause in the query that calls the view.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei030"><strong>EI030 Order by in view or single-statement TVF</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="unnecessarily-using-stored-procedures-or-multiline-table-valued-functions-where-a-view-is-sufficient"><a class="anchor" href="#unnecessarily-using-stored-procedures-or-multiline-table-valued-functions-where-a-view-is-sufficient"></a>7.11. Unnecessarily using stored procedures or multiline table-valued functions where a view is sufficient</h3>
<div class="paragraph">
<p>Stored procedures are not designed for delivering result sets. You can use stored procedures as such with INSERT &#8230;&#8203; EXEC, but you can&#8217;t nest INSERT &#8230;&#8203; EXEC so you&#8217;ll soon run into problems. If you do not need to provide input parameters, then use views, otherwise use inline table valued functions.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-cursors"><a class="anchor" href="#using-cursors"></a>7.12. Using Cursors</h3>
<div class="paragraph">
<p>SQL Server originally supported cursors to more easily port dBase II applications to SQL Server, but even then, you can sometimes use a WHILE loop as an effective substitute. However, modern versions of SQL Server provide window functions and the CROSS/OUTER APPLY syntax to cope with most of the traditional valid uses of the cursor.</p>
</div>
</div>
<div class="sect2">
<h3 id="you-have-not-explicitly-defined-the-scope-of-a-cursor"><a class="anchor" href="#you-have-not-explicitly-defined-the-scope-of-a-cursor"></a>7.13. You have not explicitly defined the scope of a cursor</h3>
<div class="paragraph">
<p>When you define a cursor with the DECLARE CURSOR statement you can, and should, define the scope of the cursor name. GLOBAL means that the cursor name should be global to the connection. LOCAL specifies that the cursor name is LOCAL to the stored procedure, trigger, or batch containing the DECLARE CURSOR statement.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp015"><strong>BP015 Scope of cursor (LOCAL/GLOBAL) is not specified</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="overusing-clr-routines"><a class="anchor" href="#overusing-clr-routines"></a>7.14. Overusing CLR routines</h3>
<div class="paragraph">
<p>There are many valid uses of CLR routines, but they are often suggested as a way to pass data between stored procedures or to get rid of performance problems. Because of the maintenance overhead, added complexity, and deployment issues associated with CLR routines, it is best to use them only after all SQL-based solutions to a problem have been found wanting or when you cannot use SQL to complete a task.</p>
</div>
</div>
<div class="sect2">
<h3 id="excessive-use-of-the-while-loop"><a class="anchor" href="#excessive-use-of-the-while-loop"></a>7.15. Excessive use of the WHILE loop</h3>
<div class="paragraph">
<p>A WHILE loop is really a type of cursor. Although a WHILE loop can be useful for several inherently procedural tasks, you can usually find a better relational way of achieving the same results. The database engine is heavily optimised to perform set-based operations rapidly. Don&#8217;t fight it!</p>
</div>
</div>
<div class="sect2">
<h3 id="relying-on-the-insertexec-statement"><a class="anchor" href="#relying-on-the-insertexec-statement"></a>7.16. Relying on the INSERT &#8230;&#8203; EXEC statement</h3>
<div class="paragraph">
<p>In a stored procedure, you must use an INSERT &#8230;&#8203; EXEC statement to retrieve data via another stored procedure and insert it into the table targeted by the first procedure. However, you cannot nest this type of statement. In addition, if the referenced stored procedure changes, it can case the first procedure to generate an error.</p>
</div>
</div>
<div class="sect2">
<h3 id="stored-procedure-that-does-not-set-a-return-code"><a class="anchor" href="#stored-procedure-that-does-not-set-a-return-code"></a>7.17. Executing stored procedure without getting result</h3>
<div class="paragraph">
<p>If a stored procedure provides one or more result, the rows will be sent to the client. For large result sets the stored procedure execution will not continue to the next statement until the result set has been completely sent to the client. For small result sets the results will be spooled for return to the client and execution will continue. Within a batch, a stored procedure that returns a result should be called with INSERT &#8230;&#8203;EXECUTE syntax.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei025"><strong>EI025 Executing stored procedure without getting result</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="forgetting-to-set-an-output-variable"><a class="anchor" href="#forgetting-to-set-an-output-variable"></a>7.18. Forgetting to set an output variable</h3>
<div class="paragraph">
<p>The values of the output parameters must be explicitly set in all code paths, otherwise the value of the output variable will be NULL. This can result in the accidental propagation of NULL values. Good defensive coding requires that you initialize the output parameters to a default value at the start of the procedure body.</p>
</div>
<div class="paragraph">
<p>See <a href="http://msdn.microsoft.com/en-us/library/dd172136(v=vs.100).aspx" class="bare">http://msdn.microsoft.com/en-us/library/dd172136(v=vs.100).aspx</a>[SR0013: Output parameter (parameter) is not populated in all code paths*</p>
</div>
</div>
<div class="sect2">
<h3 id="specifying-parameters-by-order-rather-by-assignment-where-there-are-more-than-four-parameters"><a class="anchor" href="#specifying-parameters-by-order-rather-by-assignment-where-there-are-more-than-four-parameters"></a>7.19. Specifying parameters by order rather by assignment, where there are more than four parameters</h3>
<div class="paragraph">
<p>When calling a stored procedure, it is generally better to pass in parameters by assignment rather than just relying on the order in which the parameters are defined within the procedure. This makes the code easier to understand and maintain. As with all rules, there are exceptions: It doesn&#8217;t really become a problem when there are less than a handful of parameters. Also, natively compiled procedures work fastest by passing in parameters by order.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei018"><strong>EI018 Missing parameter(s) name in procedure call</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="try-to-avoid-using-hardcoded-references-to-other-databases."><a class="anchor" href="#try-to-avoid-using-hardcoded-references-to-other-databases."></a>7.20. Try to avoid using hardcoded references to other databases.</h3>
<div class="paragraph">
<p>There is nothing wrong in executing procedures in other databases, but it is better to avoid hard-coding these references and use synonyms instead.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei016"><strong>EI016 Reference to procedure in other database</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="use-of-a-hardcoded-current-database-name-in-a-procedure-call"><a class="anchor" href="#use-of-a-hardcoded-current-database-name-in-a-procedure-call"></a>7.21. Use of a Hardcoded current database name in a procedure call</h3>
<div class="paragraph">
<p>You only need to specify the database when calling a procedure in a different database.  It is better to avoid using hardcoded references to the current database as this causes problems if you later do the inconceivable by changing the databases name or cut-and-pasting a routine. There is no performance advantage whatsoever in specifying the current database if the procedure is in the same database.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei017"><strong>EI017 Hardcoded current database name in procedure call</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="setting-the-quoted_identifier-or-ansi_nulls-options-inside-stored-procedures"><a class="anchor" href="#setting-the-quoted_identifier-or-ansi_nulls-options-inside-stored-procedures"></a>7.22. Setting the QUOTED_IDENTIFIER or ANSI_NULLS options inside stored procedures</h3>
<div class="paragraph">
<p>Stored procedures use the SET settings specified at execute time, except for SET ANSI_NULLS and SET QUOTED_IDENTIFIER. Stored procedures that specify either the SET ANSI_NULLS or SET QUOTED_IDENTIFIER use the setting specified at stored procedure creation time. If used inside a stored procedure, any such SET command is ignored</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/miscellaneous-rules/mi008"><strong>MI008 QUOTED_IDENTIFIERS option inside stored procedure, trigger or function</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-routine-with-ansi_nulls-or-quoted_identifier-options-set-to-off."><a class="anchor" href="#creating-a-routine-with-ansi_nulls-or-quoted_identifier-options-set-to-off."></a>7.23. Creating a routine with ANSI_NULLS or QUOTED_IDENTIFIER options set to OFF.</h3>
<div class="paragraph">
<p>At the time the routine is created (parse time), both options should normally be set to ON. They are ignored on execution. The reason for keeping Quoted Identifiers ON is that it is necessary when you are creating or changing indexes on computed columns or indexed views. If set to OFF, then CREATE, UPDATE, INSERT, and DELETE statements on tables with indexes on computed columns or indexed views will fail. SET QUOTED_IDENTIFIER must be ON when you are creating a filtered index or when you invoke XML data type methods. ANSI_NULLS will eventually be set to ON and this ISO compliant treatment of NULLS will not be switchable to OFF.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/deprecated-rules/dep028"><strong>DEP028 The SQL module was created with ANSI_NULLS and/or QUOTED_IDENTIFIER options set to OFF.</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="updating-a-primary-key-column"><a class="anchor" href="#updating-a-primary-key-column"></a>7.24. Updating a primary key column</h3>
<div class="paragraph">
<p>Updating a primary key column is not by itself always bad in moderation. However, the update does come with considerable overhead when maintaining referential integrity. In addition, if the primary key is also a clustered index key, the update generates more overhead in order to maintain the integrity of the table.</p>
</div>
</div>
<div class="sect2">
<h3 id="overusing-hints-to-force-a-particular-behaviour-in-joins"><a class="anchor" href="#overusing-hints-to-force-a-particular-behaviour-in-joins"></a>7.25. Overusing hints to force a particular behaviour in joins</h3>
<div class="paragraph">
<p>Hints do not take into account the changing number of rows in the tables or the changing distribution of the data between the tables. The query optimizer is generally smarter than you, and a lot more patient.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-charindex-function-in-a-where-clause"><a class="anchor" href="#using-the-charindex-function-in-a-where-clause"></a>7.26. Using the CHARINDEX function in a WHERE Clause</h3>
<div class="paragraph">
<p>Avoid using CHARINDEX in a WHERE clause to match strings if you can use LIKE (without a leading wildcard expression) to achieve the same results.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-nolock-hint"><a class="anchor" href="#using-the-nolock-hint"></a>7.27. Using the NOLOCK hint</h3>
<div class="paragraph">
<p>Avoid using the NOLOCK hint. It is much better and safer to specify the correct isolation level instead. To use NOLOCK, you would need to be very confident that your code is safe from the possible problems that the other isolation levels protect against. The NOLOCK hint forces the query to use a read uncommitted isolation level, which can result in dirty reads, non-repeatable reads and phantom reads. In certain circumstances, you can sacrifice referential integrity and end up with missing rows or duplicate reads of the same row.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-a-waitfor-delaytime-statement-in-a-routine-or-batch"><a class="anchor" href="#using-a-waitfor-delaytime-statement-in-a-routine-or-batch"></a>7.28. Using a WAITFOR DELAY/TIME statement in a routine or batch</h3>
<div class="paragraph">
<p>SQL routines or batches are not designed to include artificial delays. If many WAITFOR statements are specified on the same server, too many threads can be tied up waiting. Also, including WAITFOR will delay the completion of the SQL Server process and can result in a timeout message in the application. Sometimes, a transaction that is the victim of a deadlock can be re-executed after a very short delay, and you&#8217;ll find a WAIT used for this, which is legitimate.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/miscellaneous-rules/mi001"><strong>MI001 WAIT FOR DELAY/TIME used</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-set-rowcount-to-specify-how-many-rows-should-be-returned"><a class="anchor" href="#using-set-rowcount-to-specify-how-many-rows-should-be-returned"></a>7.29. Using SET ROWCOUNT to specify how many rows should be returned</h3>
<div class="paragraph">
<p>We had to use this option until the TOP clause (with ORDER BY) was implemented. The TOP option is much easier for the query optimizer.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/deprecated-rules/dep014"><strong>DEP014 SET ROWCOUNT option is deprecated.</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-top-100-percent-in-views-inline-functions-derived-tables-subqueries-and-common-table-expressions-ctes."><a class="anchor" href="#using-top-100-percent-in-views-inline-functions-derived-tables-subqueries-and-common-table-expressions-ctes."></a>7.30. Using TOP 100 PERCENT in views, inline functions, derived tables, subqueries, and common table expressions (CTEs).</h3>
<div class="paragraph">
<p>This is usually a reflex action to seeing the error 'The ORDER BY clause is invalid in views, inline functions, derived tables, subqueries, and common table expressions, unless TOP or FOR XML is also specified'. The message is usually a result of your ORDER BY clause being included in the wrong statement. You should include it only in the outermost query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql" data-lang="sql">CREATE FUNCTION dbo.CurrencyTable(@Region VARCHAR(20) = '%')
--returns the currency for the region, supports wildcards
--SELECT * FROM dbo.CurrencyTable(DEFAULT) returns all
--SELECT * FROM dbo.CurrencyTable('%Slov%')
RETURNS TABLE
WITH SCHEMABINDING
AS
RETURN
  (
  SELECT TOP 100 PERCENT CountryRegion.Name AS country, Currency.Name AS currency
    FROM Person.CountryRegion
      INNER JOIN Sales.CountryRegionCurrency
        ON CountryRegion.CountryRegionCode = CountryRegionCurrency.CountryRegionCode
      INNER JOIN Sales.Currency
        ON CountryRegionCurrency.CurrencyCode = Currency.CurrencyCode
    WHERE CountryRegion.Name LIKE @Region
    ORDER BY Currency.Name
  );
);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="not-specifying-the-schema-name-for-a-procedure"><a class="anchor" href="#not-specifying-the-schema-name-for-a-procedure"></a>7.31. Not specifying the Schema name for a procedure</h3>
<div class="paragraph">
<p>Usually, performance is slightly better if you specify the schema, but in certain cases, you need versions of the same stored procedure to be different depending on the user role. You can put different SPs of the same name in different schemas. You then need to specify the stored procedure without the schema because sql server will then choose the stored procedure from the schema associated with the role of the user.</p>
</div>
</div>
<div class="sect2">
<h3 id="duplicating-names-of-objects-of-different-types"><a class="anchor" href="#duplicating-names-of-objects-of-different-types"></a>7.32. Duplicating names of objects of different types</h3>
<div class="paragraph">
<p>Although it is sometimes necessary to use the same name for the same type of object in different schemas, it is never necessary to do it for different object types and it can be very confusing. You would never want a SalesStaff table and SalesStaff view and SalesStaff stored procedure.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-while-not-done-loops-without-an-error-exit"><a class="anchor" href="#using-while-not-done-loops-without-an-error-exit"></a>7.33. Using WHILE (not done) loops without an error exit</h3>
<div class="paragraph">
<p>WHILE loops must always have an error exit. The condition that you set in the WHILE statement may remain true even if the loop is spinning on an error. You can create a deadlock by running a query that includes a WAITFOR statement within a transaction that also holds locks to prevent changes to the rowset that the WAITFOR statement is trying to access.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-a-print-statement-or-statement-that-returns-a-result-in-a-trigger"><a class="anchor" href="#using-a-print-statement-or-statement-that-returns-a-result-in-a-trigger"></a>7.34. Using a PRINT statement or statement that returns a result in a trigger</h3>
<div class="paragraph">
<p>Triggers are designed for enforcing data rules, not for returning data or information. Developers often embed PRINT statements in triggers during development to provide a crude idea of how the code is progressing, but the statements need to be removed or commented out before the code is promoted beyond development.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/performance-rules/pe011"><strong>PE011 PRINT statement is used in trigger</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="select-statement-in-trigger-that-returns-data-to-the-client"><a class="anchor" href="#select-statement-in-trigger-that-returns-data-to-the-client"></a>7.35. SELECT statement in trigger that returns data to the client</h3>
<div class="paragraph">
<p>Although it is possible to do, it is unwise. A trigger should never return data to a client. It is possible to place a SELECT statement in a trigger but it serves no practical useful purpose, and can have unexpected effects. A trigger behaves much like a stored procedure in that, when the trigger fires, results can be returned to the calling application. This requires special handling because these returned results would have to be handled in some way, and this would have to be written into every application in which modifications to the trigger table are allowed.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp003"><strong>BP003 SELECT in trigger</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-top-without-order-by"><a class="anchor" href="#using-top-without-order-by"></a>7.36. Using TOP without ORDER BY</h3>
<div class="paragraph">
<p>Using TOP without an ORDER BY clause in a SELECT statement is meaningless and cannot be guaranteed to give consistent results. because asking for the TOP 10 rows implies a certain order, and tables have no implicit logical order.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp006"><strong>BP006 TOP without ORDER BY</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-a-case-statement-without-the-else-clause"><a class="anchor" href="#using-a-case-statement-without-the-else-clause"></a>7.37. Using a CASE statement without the ELSE clause</h3>
<div class="paragraph">
<p>Always specify a default option even if you believe that it is impossible for that condition to happen. Someone might change the logic, or you could be wrong in thinking a particular outcome is impossible.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp012"><strong>BP012 CASE without ELSE</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-executestring"><a class="anchor" href="#using-executestring"></a>7.38. Using EXECUTE(string)</h3>
<div class="paragraph">
<p>Don&#8217;t use EXEC to run dynamic SQL. It is there only for backward compatibility and is a commonly used vector for SQL injection. Use sp_executesql instead because it allows parameter substitutions for both inputs and outputs and also because the execution plan that sp_executesql produces is more likely to be reused.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp013"><strong>BP013 EXECUTE(string) is used</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-group-by-all-column-group-by-number-compute-or-compute-by-clause"><a class="anchor" href="#using-the-group-by-all-column-group-by-number-compute-or-compute-by-clause"></a>7.39. Using the GROUP BY ALL &lt;column&gt;, GROUP BY &lt;number&gt;, COMPUTE, or COMPUTE BY clause</h3>
<div class="paragraph">
<p>The GROUP BY ALL &lt;column&gt; clause and the GROUP BY &lt;number&gt; clause are deprecated. There are other ways to perform these operations using the standard GROUP BY and GROUPING syntax. The COMPUTE and COMPUTE BY operations were devised for printed summary results. The ROLLUP and CUBE clauses are a better alternative.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-numbers-in-the-order-by-clause-to-specify-column-order"><a class="anchor" href="#using-numbers-in-the-order-by-clause-to-specify-column-order"></a>7.40. Using numbers in the ORDER BY clause to specify column order</h3>
<div class="paragraph">
<p>It is certainly possible to specify nonnegative integers to represent the columns in an ORDER BY clause, based on how those columns appear in the select list, but this approach makes it difficult to understand the code at a glance and can lead to unexpected consequences when you forget you&#8217;ve done it and alter the order of the columns in the select list.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/deprecated-rules/dep003"><strong>DEP003 GROUP BY ALL clause is deprecated.</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-unnecessary-three-part-and-four-part-column-references-in-a-select-list"><a class="anchor" href="#using-unnecessary-three-part-and-four-part-column-references-in-a-select-list"></a>7.41. Using unnecessary three-part and four-part column references in a select list</h3>
<div class="paragraph">
<p>Sometimes, when a table is referenced in another database or server, programmers believe that the two or three-part table name needs to be applied to the columns. This is unnecessary and meaningless. Just the table name is required for the columns. Three-part column names might be necessary in a join if you have duplicate table names, with duplicate column names, in different schemas, in which case, you ought to be using aliases. The same goes for cross-database joins.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/deprecated-rules/dep026"><strong>DEP026 Three-part and four-part column references in SELECT list are deprecated.</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-range-rather-than-rows-in-sql-server-2012"><a class="anchor" href="#using-range-rather-than-rows-in-sql-server-2012"></a>7.42. Using RANGE rather than ROWS in SQL Server 2012</h3>
<div class="paragraph">
<p>The implementation of the RANGE option in a window frame ORDER BY clause is inadequate for any serious use. Stick to the ROWS option whenever possible and try to avoid ordering without framing.</p>
</div>
</div>
<div class="sect2">
<h3 id="doing-complex-error-handling-in-a-transaction-before-the-rollback-command"><a class="anchor" href="#doing-complex-error-handling-in-a-transaction-before-the-rollback-command"></a>7.43. Doing complex error-handling in a transaction before the ROLLBACK command</h3>
<div class="paragraph">
<p>The database engine releases locks only when the transaction is rolled back or committed. It is unwise to delay this because other processes may be forced to wait. Do any complex error handling after the ROLLBACK command wherever possible.</p>
</div>
</div>
<div class="sect2">
<h3 id="use-of-begin-transaction-without-rollback-transaction"><a class="anchor" href="#use-of-begin-transaction-without-rollback-transaction"></a>7.44. Use of BEGIN TRANSACTION without ROLLBACK TRANSACTION</h3>
<div class="paragraph">
<p>ROLLBACK TRANSACTION rolls back a transaction to the beginning of it, or to a savepoint inside the transaction. You don&#8217;t need a ROLLBACK TRANSACTION statement within a transaction, but if there isn&#8217;t one, then it may be a sign that error handling has not been refined to production standards</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei019"><strong>EI019 BEGIN TRANSACTION without ROLLBACK TRANSACTION</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="use-of-rollback-transaction-without-begin-transaction"><a class="anchor" href="#use-of-rollback-transaction-without-begin-transaction"></a>7.45. Use of ROLLBACK TRANSACTION without BEGIN TRANSACTION</h3>
<div class="paragraph">
<p>It is possible to have a ROLLBACK TRANSACTION within a block where there is no explicit transaction. This will trigger an error if the code is executed outside a transaction, and suggests that transactions are being held open unnecessarily.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/deprecated-rules/ei020"><strong>EI020 ROLLBACK TRANSACTION without BEGIN TRANSACTION</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="not-defining-a-default-value-for-a-select-assignment-to-a-variable"><a class="anchor" href="#not-defining-a-default-value-for-a-select-assignment-to-a-variable"></a>7.46. Not defining a default value for a SELECT assignment to a variable</h3>
<div class="paragraph">
<p>If an assignment is made to a variable within a SELECT &#8230;&#8203; FROM statement and no result is returned, that variable will retain its current value. If no rows are returned, the variable assignment should be explicit, so you should initialise the variable with a default value.</p>
</div>
</div>
<div class="sect2">
<h3 id="not-defining-a-default-value-for-a-set-assignment-that-is-the-result-of-a-query"><a class="anchor" href="#not-defining-a-default-value-for-a-set-assignment-that-is-the-result-of-a-query"></a>7.47. Not defining a default value for a SET assignment that is the result of a query</h3>
<div class="paragraph">
<p>If a variable&#8217;s SET assignment is based on a query result and the query returns no rows, the variable is set to NULL. In this case, you should assign a default value to the variable unless you want it to be NULL.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-value-of-a-nullable-column-is-not-checked-for-nulls-when-used-in-an-expression"><a class="anchor" href="#the-value-of-a-nullable-column-is-not-checked-for-nulls-when-used-in-an-expression"></a>7.48. The value of a nullable column is not checked for NULLs when used in an expression</h3>
<div class="paragraph">
<p>If you are using a nullable column in an expression, you should use a COALESCE or CASE expression or use the ISNULL(<em>column, default_value</em>) function to first verify whether the value is NULL.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-nullif-expression"><a class="anchor" href="#using-the-nullif-expression"></a>7.49. Using the NULLIF expression</h3>
<div class="paragraph">
<p>The NULLIF expression compares two expressions and returns the first one if the two are not equal. If the expressions are equal then NULLIF returns a NULL value of the data type of the first expression. NULLIF is syntactic sugar. Use the CASE statement instead so that ordinary folks can understand what you&#8217;re trying to do. The two are treated identically.</p>
</div>
</div>
<div class="sect2">
<h3 id="not-putting-all-the-ddl-statements-at-the-beginning-of-the-batch"><a class="anchor" href="#not-putting-all-the-ddl-statements-at-the-beginning-of-the-batch"></a>7.50. Not putting all the DDL statements at the beginning of the batch</h3>
<div class="paragraph">
<p>Don&#8217;t mix data manipulation language (DML) statements with data definition language (DDL_ statements. Instead, put all the DDL statements at the beginning of your procedures or batches.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/performance-rules/pe010"><strong>PE010 Interleaving DDL and DML in stored procedure/trigger.</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="using-meaningless-aliases-for-tables-e.g.-a-b-c-d-e"><a class="anchor" href="#using-meaningless-aliases-for-tables-e.g.-a-b-c-d-e"></a>7.51. Using meaningless aliases for tables (e.g., a, b, c, d, e)</h3>
<div class="paragraph">
<p>Aliases aren&#8217;t actually meant to cut down on the typing but rather to make your code clearer. To use single characters is antisocial.</p>
</div>
</div>
<div class="sect2">
<h3 id="variable-type-is-not-fully-compatible-with-procedure-parameter-type"><a class="anchor" href="#variable-type-is-not-fully-compatible-with-procedure-parameter-type"></a>7.52. Variable type is not fully compatible with procedure parameter type</h3>
<div class="paragraph">
<p>A parameter passed to a procedure or function must be of a type that can be cast into the variable datatype declared for that parameter in the body of the routine. It should be of exactly the same type so as to avoid the extra processing to resolve an implicit conversion.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei001"><strong>EI001 Incompatible variable type for procedure call</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="literal-type-is-not-fully-compatible-with-procedure-parameter-type"><a class="anchor" href="#literal-type-is-not-fully-compatible-with-procedure-parameter-type"></a>7.53. Literal type is not fully compatible with procedure parameter type</h3>
<div class="paragraph">
<p>A parameter passed to a procedure can be a literal (e.g. 1,'03 jun 2017' or 'hello world') but it must be possible to cast it unambiguously to the variable datatype declared for that parameter in the body of the routine.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei002"><strong>EI002 Incompatible literal type for procedure call</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="subquery-may-return-more-than-one-row"><a class="anchor" href="#subquery-may-return-more-than-one-row"></a>7.54. Subquery may return more than one row</h3>
<div class="paragraph">
<p>A subquery can only be scalar, meaning that it can return just one value. Even if you correctly place just one expression in your select list, you must also ensure that just one row is returned. TOP 1 can be used if there is an ORDER BY clause</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei003">EI003 Non-scalar subquery in place of a scalar*</a></p>
</div>
</div>
<div class="sect2">
<h3 id="a-named-parameter-is-not-found-in-parameter-list-of-a-procedure"><a class="anchor" href="#a-named-parameter-is-not-found-in-parameter-list-of-a-procedure"></a>7.55. A named parameter is not found in parameter list of a procedure</h3>
<div class="paragraph">
<p>Parameters can be passed by position in a comma-delimited list, or by name, where order position isn&#8217;t required. Any parameters that are specified by name must have the name identical to the definition for that procedure</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei004"><strong>EI004 Extra parameter passed</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="use-of-the-position-notation-after-the-named-notation-for-parameters-when-calling-a-procedure"><a class="anchor" href="#use-of-the-position-notation-after-the-named-notation-for-parameters-when-calling-a-procedure"></a>7.56. Use of the position notation after the named notation for parameters when calling a procedure</h3>
<div class="paragraph">
<p>Parameters can be passed by position in a comma-delimited list, or by name, but it is a bad idea to mix the two methods even when it is possible. If a parameter has a default value assigned to it, it can be left out of the parameter list, and it is difficult to check whether the values you supply are for the parameters you intend.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei005"><strong>EI005 Unnamed call after named call</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="parameter-is-not-passed-to-a-procedure-and-no-default-is-provided."><a class="anchor" href="#parameter-is-not-passed-to-a-procedure-and-no-default-is-provided."></a>7.57. Parameter is not passed to a procedure and no default is provided.</h3>
<div class="paragraph">
<p>With procedures and functions, parameters can be assigned default values that are used when a value isn&#8217;t passed for that parameter when calling the procedure. However, if a parameter isn&#8217;t assigned a value and there is no default provided it is an error. If you don&#8217;t want to provide a value and a default is provided, use the DEFAULT keyword to specify that the default value should be used.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei006"><strong>EI006 Required parameter is not passed</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="procedure-parameter-is-not-defined-as-output-but-marked-as-output-in-procedure-call-statement."><a class="anchor" href="#procedure-parameter-is-not-defined-as-output-but-marked-as-output-in-procedure-call-statement."></a>7.58. Procedure parameter is not defined as OUTPUT, but marked as OUTPUT in procedure call statement.</h3>
<div class="paragraph">
<p>Output scalar parameters for procedures are passed to the procedure, and can have their value altered within the procedure. This allows procedures to return scalar output. The formal parameter must be declared as an OUTPUT parameter if the actual parameter that is passed had the OUTPUT keyword. This triggers an error.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei007"><strong>EI007 Call parameter declared as output</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="procedure-parameter-is-defined-as-output-but-is-not-marked-as-output-in-procedure-call-statement."><a class="anchor" href="#procedure-parameter-is-defined-as-output-but-is-not-marked-as-output-in-procedure-call-statement."></a>7.59. Procedure parameter is defined as OUTPUT, but is not marked as OUTPUT in procedure call statement.</h3>
<div class="paragraph">
<p>Output scalar parameters for procedures are passed to the procedure, and can have their value altered within the procedure. This allows procedures to return scalar output. However, the matching variable passed as the output parameter in the module or command string must also have the keyword OUTPUT. There is no error but the resultant value is NULL, which you are unlikely to want.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei008"><strong>EI008 Call parameter is not declared as output</strong></a></p>
</div>
</div>
<div class="sect2">
<h3 id="number-of-passed-parameters-exceeds-the-number-of-procedure-parameters"><a class="anchor" href="#number-of-passed-parameters-exceeds-the-number-of-procedure-parameters"></a>7.60. Number of passed parameters exceeds the number of procedure parameters</h3>
<div class="paragraph">
<p>Parameters can be passed to procedures and functions in an ordered delimited list, but never more than the number of parameters. For a function, this must have the same number of list members as the parameters. For a procedure you can have fewer if defaults are declared in parameters</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/execution-rules/ei009"><strong>EI009 Call has more parameters than required</strong></a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-loopholes"><a class="anchor" href="#security-loopholes"></a>8. Security Loopholes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="using-sql-server-logins-especially-without-password-expirations-or-windows-password-policy"><a class="anchor" href="#using-sql-server-logins-especially-without-password-expirations-or-windows-password-policy"></a>8.1. Using SQL Server logins, especially without password expirations or Windows password policy</h3>
<div class="paragraph">
<p>Sometimes you must use SQL Server logins. For example, with Microsoft Azure SQL Database, you have no other option, but it isn&#8217;t satisfactory. SQL Server logins and passwords have to be sent across the network and can be read by sniffers. They also require passwords to be stored on client machines and in connection strings. SQL logins are particularly vulnerable to a brute-force attacks. They are also less convenient because the SQL Server Management Studio (SSMS) registered servers don&#8217;t store password information and so can&#8217;t be used for executing SQL across a range of servers. Windows-based authentication is far more robust and should be used where possible.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-xp_cmdshell-system-stored-procedure"><a class="anchor" href="#using-the-xp_cmdshell-system-stored-procedure"></a>8.2. Using the xp_cmdshell system stored procedure</h3>
<div class="paragraph">
<p>Use xp_cmdshell in a routine only as a last resort, due to the elevated security permissions they require and consequential security risk. The xp_cmdshell procedure is best reserved for scheduled jobs where security can be better managed.</p>
</div>
</div>
<div class="sect2">
<h3 id="authentication-set-to-mixed-mode"><a class="anchor" href="#authentication-set-to-mixed-mode"></a>8.3. Authentication set to Mixed Mode</h3>
<div class="paragraph">
<p>Ensure that Windows Authentication Mode is used wherever possible. SQL Server authentication is necessary only when a server is remote or outside the domain, or if third-party software requires SQL authentication for remote maintenance. Windows Authentication is less vulnerable, and avoids having to transmit passwords over the network or store them in connection strings.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-dynamic-sql-without-the-with-execute-as-clause"><a class="anchor" href="#using-dynamic-sql-without-the-with-execute-as-clause"></a>8.4. Using dynamic SQL without the WITH EXECUTE AS clause</h3>
<div class="paragraph">
<p>Because of ownership chaining and SQL injection risks, dynamic SQL requires constant vigilance to ensure that it is used only as intended. Use the EXECUTE AS clause to ensure the dynamic SQL code inside the procedure is executed only in the context you expect, and use loginless users with just the specific permissions required but no others in the EXECUTE AS clause.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-dynamic-sql-with-the-possibility-of-sql-injection"><a class="anchor" href="#using-dynamic-sql-with-the-possibility-of-sql-injection"></a>8.5. Using dynamic SQL with the possibility of SQL injection</h3>
<div class="paragraph">
<p>SQL injection can be used not only from an application but also by a database user who lacks, but wants, the permissions necessary to perform a particular role, or who simply wants to access sensitive data. If dynamic SQL is executed within a stored procedure, under the temporary EXECUTE AS permission of a user with sufficient privileges to create users, and it can be accessed by a malicious user, then suitable precautions must be taken to make this impossible. These precautions start with giving EXECUTE AS permissions only to WITHOUT LOGIN users with least-necessary permissions, and using sp_ExecuteSQL with parameters rather than EXECUTE.</p>
</div>
<div class="paragraph">
<p><a href="https://documentation.red-gate.com/codeanalysis/best-practice-rules/bp013"><strong>BP013 EXECUTE(string) is used</strong></a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-03-09 13:38:10 GMTST
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>